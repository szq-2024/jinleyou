{"version":3,"file":"auth.js","sources":["api/auth.js"],"sourcesContent":["// api/auth.js\nexport const checkTokenExpiration = () => {\n  const token = uni.getStorageSync('token');\n  if (!token) return null;\n\n  try {\n    // 1. 安全分割Token\n    const parts = token.split('.');\n    if (parts.length !== 3) throw new Error('非法Token格式');\n\n    // 2. 提取并修复Base64Url\n    let payloadBase64 = parts[1]\n      .replace(/-/g, '+')\n      .replace(/_/g, '/');\n    \n    // 3. 补充Base64填充\n    while (payloadBase64.length % 4) {\n      payloadBase64 += '=';\n    }\n\n    // 4. 兼容小程序环境的解码方法\n    const decodedStr = decodeBase64(payloadBase64);\n    console.log('🔍 解码后的Payload字符串:', decodedStr);\n\n    // 5. 解析JSON\n    const decoded = JSON.parse(decodedStr);\n    \n    // 6. 验证有效期\r\n\tconst bufferTime = 300000; // 5分钟\n    const isExpired = Date.now() >= decoded.exp * 1000;\n    return isExpired ? null : token;\n\n  } catch (error) {\n    console.error('🚨 Token解析异常', {\n      token,\n      error: error.message,\n      stack: error.stack\n    });\n    uni.removeStorageSync('token');\n    return null;\n  }\n};\n\n// 专为小程序优化的Base64解码\nfunction decodeBase64(base64) {\n  const bytes = uni.base64ToArrayBuffer(base64);\n  const byteArray = new Uint8Array(bytes);\n  let binary = '';\n  for (let i = 0; i < byteArray.length; i++) {\n    binary += String.fromCharCode(byteArray[i]);\n  }\n  return decodeURIComponent(escape(binary));\n}"],"names":["uni"],"mappings":";;AACY,MAAC,uBAAuB,MAAM;AACxC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,MAAI,CAAC;AAAO,WAAO;AAEnB,MAAI;AAEF,UAAM,QAAQ,MAAM,MAAM,GAAG;AAC7B,QAAI,MAAM,WAAW;AAAG,YAAM,IAAI,MAAM,WAAW;AAGnD,QAAI,gBAAgB,MAAM,CAAC,EACxB,QAAQ,MAAM,GAAG,EACjB,QAAQ,MAAM,GAAG;AAGpB,WAAO,cAAc,SAAS,GAAG;AAC/B,uBAAiB;AAAA,IAClB;AAGD,UAAM,aAAa,aAAa,aAAa;AAC7CA,kBAAY,MAAA,MAAA,OAAA,qBAAA,sBAAsB,UAAU;AAG5C,UAAM,UAAU,KAAK,MAAM,UAAU;AAGxC,UAAM,aAAa;AAChB,UAAM,YAAY,KAAK,IAAK,KAAI,QAAQ,MAAM;AAC9C,WAAO,YAAY,OAAO;AAAA,EAE3B,SAAQ,OAAO;AACdA,kBAAAA,MAAA,MAAA,SAAA,qBAAc,gBAAgB;AAAA,MAC5B;AAAA,MACA,OAAO,MAAM;AAAA,MACb,OAAO,MAAM;AAAA,IACnB,CAAK;AACDA,wBAAI,kBAAkB,OAAO;AAC7B,WAAO;AAAA,EACR;AACH;AAGA,SAAS,aAAa,QAAQ;AAC5B,QAAM,QAAQA,cAAAA,MAAI,oBAAoB,MAAM;AAC5C,QAAM,YAAY,IAAI,WAAW,KAAK;AACtC,MAAI,SAAS;AACb,WAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,cAAU,OAAO,aAAa,UAAU,CAAC,CAAC;AAAA,EAC3C;AACD,SAAO,mBAAmB,OAAO,MAAM,CAAC;AAC1C;;"}