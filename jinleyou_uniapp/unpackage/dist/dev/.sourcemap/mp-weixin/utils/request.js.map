{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// utils/request.js\nconst baseURL = process.env.NODE_ENV === 'development' \n  ? 'http://localhost:3000/api' \n  : 'https://apifoxmock.com/m1/4728220-0-default/api'\n\nexport default function(options) {\n  const token = uni.getStorageSync('token')\n  const defaultHeaders = {\n    'Content-Type': 'application/json',\n    'Authorization': token ? `Bearer ${token}` : ''\n  }\n\n  return new Promise((resolve, reject) => {\n    uni.request({\n      url: baseURL + options.url,\n      method: options.method || 'GET',\n      data: options.data || {},\n      header: { ...defaultHeaders, ...(options.header || {}) },\n      success: (res) => {\n        // 统一处理HTTP状态码\n        if (res.statusCode === 200) {\n          // 兼容不同后端返回格式\n          const successCode = [200, 1] // 可配置的成功状态码\n          if (successCode.includes(res.data.code)) {\n            resolve(res.data.data || res.data)\n          } else {\n            const errorMsg = res.data.msg || '请求失败'\n            uni.showToast({ title: errorMsg, icon: 'none' })\n            reject(new Error(errorMsg))\n          }\n        } else if (res.statusCode === 401) {\n          uni.navigateTo({ url: '/pages/auth/login' })\n          reject(new Error('请重新登录'))\n        } else {\n          reject(new Error(`HTTP错误: ${res.statusCode}`))\n        }\n      },\n      fail: (err) => {\n        uni.showToast({ title: '网络请求失败', icon: 'none' })\n        reject(err)\n      }\n    })\n  })\n}"],"names":["uni"],"mappings":";;AACA,MAAM,UACF;AAGJ,SAAA,QAAwB,SAAS;AACzB,QAAA,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,QAAM,iBAAiB;AAAA,IACrB,gBAAgB;AAAA,IAChB,iBAAiB,QAAQ,UAAU,KAAK,KAAK;AAAA,EAAA;AAG/C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,UAAU,QAAQ;AAAA,MACvB,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAC;AAAA,MACvB,QAAQ,EAAE,GAAG,gBAAgB,GAAI,QAAQ,UAAU,CAAA,EAAI;AAAA,MACvD,SAAS,CAAC,QAAQ;AAEZ,YAAA,IAAI,eAAe,KAAK;AAEpB,gBAAA,cAAc,CAAC,KAAK,CAAC;AAC3B,cAAI,YAAY,SAAS,IAAI,KAAK,IAAI,GAAG;AACvC,oBAAQ,IAAI,KAAK,QAAQ,IAAI,IAAI;AAAA,UAAA,OAC5B;AACC,kBAAA,WAAW,IAAI,KAAK,OAAO;AACjCA,0BAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AACxC,mBAAA,IAAI,MAAM,QAAQ,CAAC;AAAA,UAC5B;AAAA,QAAA,WACS,IAAI,eAAe,KAAK;AACjCA,wBAAAA,MAAI,WAAW,EAAE,KAAK,oBAAqB,CAAA;AACpC,iBAAA,IAAI,MAAM,OAAO,CAAC;AAAA,QAAA,OACpB;AACL,iBAAO,IAAI,MAAM,WAAW,IAAI,UAAU,EAAE,CAAC;AAAA,QAC/C;AAAA,MACF;AAAA,MACA,MAAM,CAAC,QAAQ;AACbA,sBAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C,eAAO,GAAG;AAAA,MACZ;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AACH;;"}