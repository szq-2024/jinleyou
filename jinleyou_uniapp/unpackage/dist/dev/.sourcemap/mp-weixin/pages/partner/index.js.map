{"version":3,"file":"index.js","sources":["pages/partner/index.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGFydG5lci9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"partner-container\">\n    <!-- 头部区域 -->\n    <header class=\"header-section\">\n      <nav class=\"tab-nav\">\n        <button \n          :class=\"['tab-btn', { 'active-tab': activeTab === 'plans' }]\" \n          @click=\"activeTab = 'plans'\"\n        >\n          🗺️ 旅行计划\n        </button>\n        <button \n          :class=\"['tab-btn', { 'active-tab': activeTab === 'guides' }]\" \n          @click=\"activeTab = 'guides'\"\n        >\n          🧭 导游服务\n        </button>\n      </nav>\n    </header>\n\n    <!-- 内容区域 -->\n    <main class=\"content-section\">\n      <!-- 筛选面板 -->\n      <view class=\"filter-section\">\n        <view \n          class=\"filter-header\"\n          @click=\"toggleFilterCollapse\"\n        >\n          <text>🔍 筛选条件</text>\n          <text>{{ isCollapsed ? '展开' : '收起' }}</text>\n        </view>\n        \n        <view v-if=\"!isCollapsed\" class=\"filter-content\">\n          <template v-if=\"activeTab === 'plans'\">\n            <view class=\"filter-group\">\n              <picker \n                mode=\"date\" \n                :value=\"filterDateRange[0]\" \n                @change=\"handleDateStart\"\n                class=\"filter-input\"\n              >\n                <text>{{ filterDateRange[0] || '开始日期' }}</text>\n              </picker>\n              <text class=\"date-separator\">至</text>\n              <picker \n                mode=\"date\" \n                :value=\"filterDateRange[1]\" \n                @change=\"handleDateEnd\"\n                class=\"filter-input\"\n              >\n                <text>{{ filterDateRange[1] || '结束日期' }}</text>\n              </picker>\n            </view>\n\n            <input \n              v-model=\"filterLocation\" \n              placeholder=\"输入地点\" \n              class=\"filter-input\"\n            />\n\n            <view class=\"preference-filter\">\n              <checkbox-group @change=\"handlePreferenceChange\">\n                <label \n                  v-for=\"pref in validPreferences\" \n                  :key=\"pref\" \n                  class=\"preference-tag\"\n                >\n                  <checkbox :value=\"pref\" :checked=\"filterPreferences.includes(pref)\" />\n                  {{ pref }}\n                </label>\n              </checkbox-group>\n            </view>\n          </template>\n\n          <template v-else>\n            <view class=\"filter-group\">\n              <picker \n                mode=\"date\" \n                :value=\"filterGuideDateRange[0]\" \n                @change=\"handleGuideDateStart\"\n                class=\"filter-input\"\n              >\n                <text>{{ filterGuideDateRange[0] || '开始日期' }}</text>\n              </picker>\n              <text class=\"date-separator\">至</text>\n              <picker \n                mode=\"date\" \n                :value=\"filterGuideDateRange[1]\" \n                @change=\"handleGuideDateEnd\"\n                class=\"filter-input\"\n              >\n                <text>{{ filterGuideDateRange[1] || '结束日期' }}</text>\n              </picker>\n            </view>\n\n            <input \n              v-model=\"filterDestination\" \n              placeholder=\"输入目的地\" \n              class=\"filter-input\"\n            />\n\n            <view class=\"preference-filter\">\n              <checkbox-group @change=\"handleServiceTypeChange\">\n                <label \n                  v-for=\"type in validServiceTypes\" \n                  :key=\"type\" \n                  class=\"preference-tag\"\n                >\n                  <checkbox :value=\"type\" :checked=\"filterServiceTypes.includes(type)\" />\n                  {{ type }}\n                </label>\n              </checkbox-group>\n            </view>\n          </template>\n\n          <view class=\"filter-actions\">\n            <button class=\"reset-btn\" @click=\"resetFilters\">重置</button>\n            <button class=\"confirm-btn\" @click=\"loadData\">查询</button>\n          </view>\n        </view>\n      </view>\n\n      <!-- 内容列表 -->\n      <template v-if=\"activeTab === 'plans'\">\n        <empty-state \n          v-if=\"filteredPlans.length === 0\" \n          description=\"暂时没有找到旅行计划\"\n          action-text=\"创建计划\"\n          @action=\"navigateToCreate('plan')\"\n        />\n        <card-list \n          v-else \n          :items=\"filteredPlans\" \n          type=\"plan\" \n          @item-click=\"startChat\"\n        />\n      </template>\n\n      <template v-else>\n        <empty-state \n          v-if=\"filteredGuides.length === 0\"\n          description=\"暂时没有可预约的导游\"\n          action-text=\"发布服务\"\n          @action=\"navigateToCreate('guide')\"\n        />\n        <card-list \n          v-else \n          :items=\"filteredGuides\" \n          type=\"guide\" \n          @item-click=\"startChat\"\n        />\n      </template>\n    </main>\n\n    <!-- 悬浮操作按钮 -->\n    <view class=\"floating-actions\">\n      <button class=\"fab-button\" @click=\"navigateToCreate(activeTab)\">\n        <text class=\"fab-icon\">{{ activeTab === 'plans' ? '✏️' : '✨' }}</text>\n      </button>\n    </view>\n\n    <!-- 加载状态 -->\n    <loading-overlay :visible=\"isLoading\" />\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, watch, onMounted, nextTick } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport dayjs from 'dayjs';\nimport { http } from '@/api/http';\n\n// 组件\nimport EmptyState from '@/components/EmptyState.vue';\nimport CardList from '@/components/CardList.vue';\nimport LoadingOverlay from '@/components/LoadingOverlay.vue';\n\n// 响应式状态\nconst activeTab = ref('plans');\nconst isLoading = ref(false);\nconst isCollapsed = ref(false);\nconst plans = ref([]);\nconst guides = ref([]);\n\n// 筛选条件\nconst filterDateRange = ref([]);\nconst filterLocation = ref('');\nconst filterPreferences = ref([]);\nconst validPreferences = ['美食', '历史', '自然', '摄影', '亲子'];\n\nconst filterGuideDateRange = ref([]);\nconst filterDestination = ref('');\nconst filterServiceTypes = ref([]);\nconst validServiceTypes = ['历史讲解', '户外探险', '城市观光', '美食文化'];\n\n// 计算属性\nconst filteredPlans = computed(() => {\n  return plans.value.filter(plan => \n    dayjs(plan.date).isSameOrAfter(dayjs().startOf('day')) &&\n    (filterLocation.value ? plan.destination.includes(filterLocation.value) : true) &&\n    (filterDateRange.value.length === 2 \n      ? dayjs(plan.date).isBetween(filterDateRange.value[0], filterDateRange.value[1]) \n      : true) &&\n    (filterPreferences.value.length > 0 \n      ? filterPreferences.value.includes(plan.preference) \n      : true)\n  );\n});\n\nconst filteredGuides = computed(() => {\n  return guides.value.filter(guide => \n    dayjs(guide.serviceDate).isSameOrAfter(dayjs().startOf('day')) &&\n    (filterDestination.value ? guide.destination.includes(filterDestination.value) : true) &&\n    (filterGuideDateRange.value.length === 2 \n      ? dayjs(guide.serviceDate).isBetween(filterGuideDateRange.value[0], filterGuideDateRange.value[1]) \n      : true) &&\n    (filterServiceTypes.value.length > 0 \n      ? filterServiceTypes.value.includes(guide.type) \n      : true)\n  );\n});\n\n// 方法\nconst toggleFilterCollapse = () => {\n  isCollapsed.value = !isCollapsed.value;\n};\n\nconst resetFilters = () => {\n  if (activeTab.value === 'plans') {\n    filterDateRange.value = [];\n    filterLocation.value = '';\n    filterPreferences.value = [];\n  } else {\n    filterGuideDateRange.value = [];\n    filterDestination.value = '';\n    filterServiceTypes.value = [];\n  }\n  nextTick(() => {\n    loadData();\n  });\n};\n\nconst navigateToCreate = (type) => {\n  uni.navigateTo({\n    url: `/pages/partner/create-${type}`\n  });\n};\n\nconst startChat = (item) => {\n  const userId = item.user_id || item.user?.id;\n  if (!userId) {\n    console.error('Invalid user data:', item);\n    return;\n  }\n  uni.navigateTo({\n    url: `/pages/chat/chat?userId=${userId}&title=${encodeURIComponent(item.title)}`\n  });\n};\n\n// 筛选处理\nconst handleDateStart = (e) => {\n  filterDateRange.value[0] = e.detail.value;\n};\n\nconst handleDateEnd = (e) => {\n  filterDateRange.value[1] = e.detail.value;\n};\n\nconst handleGuideDateStart = (e) => {\n  filterGuideDateRange.value[0] = e.detail.value;\n};\n\nconst handleGuideDateEnd = (e) => {\n  filterGuideDateRange.value[1] = e.detail.value;\n};\n\nconst handlePreferenceChange = (e) => {\n  filterPreferences.value = e.detail.value;\n};\n\nconst handleServiceTypeChange = (e) => {\n  filterServiceTypes.value = e.detail.value;\n};\n\n// 数据获取\nconst fetchPlans = async () => {\n  try {\n    isLoading.value = true;\n    const params = {\n      dateStart: filterDateRange.value[0],\n      dateEnd: filterDateRange.value[1],\n      location: filterLocation.value,\n      preferences: filterPreferences.value.join(',')\n    };\n    const response = await http.get('/api/travel-plans', { params });\n    plans.value = response.data || [];\n  } catch (error) {\n    console.error('获取旅行计划失败:', error);\n    plans.value = [];\n  } finally {\n    isLoading.value = false;\n  }\n};\n\nconst fetchGuides = async () => {\n  try {\n    isLoading.value = true;\n    const params = {\n      dateStart: filterGuideDateRange.value[0],\n      dateEnd: filterGuideDateRange.value[1],\n      destination: filterDestination.value,\n      type: filterServiceTypes.value.join(',')\n    };\n    const response = await http.get('/api/guide-services', { params });\n    guides.value = response.data || [];\n  } catch (error) {\n    console.error('获取导游服务失败:', error);\n    guides.value = [];\n  } finally {\n    isLoading.value = false;\n  }\n};\n\nconst loadData = () => {\n  if (activeTab.value === 'plans') {\n    fetchPlans();\n  } else {\n    fetchGuides();\n  }\n};\n\n// 生命周期\nwatch(activeTab, (newVal) => {\n  isCollapsed.value = false;\n  resetFilters();\n});\n\nonShow(() => {\n  loadData();\n});\n\nonMounted(() => {\n  loadData();\n});\n</script>\n\n<style lang=\"scss\">\n.partner-container {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background: #f8f9fb;\n}\n\n.header-section {\n  padding: 24rpx 32rpx;\n  background: linear-gradient(135deg, #4369f4 0%, #284bce 100%);\n  color: white;\n  border-radius: 0 0 40rpx 40rpx;\n  box-shadow: 0 8rpx 40rpx rgba(66, 133, 244, 0.15);\n}\n\n.tab-nav {\n  display: flex;\n  gap: 24rpx;\n  margin-top: 24rpx;\n}\n\n.tab-btn {\n  padding: 12rpx 40rpx;\n  border-radius: 32rpx;\n  background: rgba(255, 255, 255, 0.15);\n  font-size: 26rpx;\n  transition: all 0.3s;\n\n  &.active-tab {\n    background: white;\n    color: #4369f4;\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n  }\n}\n\n.content-section {\n  flex: 1;\n  padding: 32rpx;\n}\n\n.filter-section {\n  background: white;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\n  margin-bottom: 32rpx;\n}\n\n.filter-header {\n  padding: 24rpx;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  background: #f5f7fa;\n  border-radius: 8rpx;\n  font-size: 28rpx;\n  color: #606266;\n  &:active {\n    background: #ebeff5;\n  }\n}\n\n.filter-content {\n  padding: 24rpx;\n}\n\n.filter-group {\n  display: flex;\n  align-items: center;\n  gap: 16rpx;\n  margin-bottom: 24rpx;\n}\n\n.filter-input {\n  flex: 1;\n  padding: 20rpx 24rpx;\n  border: 1rpx solid #eee;\n  border-radius: 8rpx;\n  font-size: 28rpx;\n  background: #f8f9fa;\n}\n\n.date-separator {\n  color: #909399;\n  padding: 0 12rpx;\n}\n\n.preference-filter {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 16rpx;\n  margin-top: 24rpx;\n}\n\n.preference-tag {\n  display: inline-flex;\n  align-items: center;\n  padding: 12rpx 24rpx;\n  background: #f5f7fa;\n  border-radius: 40rpx;\n  font-size: 24rpx;\n  color: #606266;\n  checkbox {\n    margin-right: 8rpx;\n    transform: scale(0.9);\n  }\n}\n\n.filter-actions {\n  display: flex;\n  gap: 16rpx;\n  margin-top: 24rpx;\n  \n  button {\n    flex: 1;\n    padding: 16rpx 24rpx;\n    border-radius: 24rpx;\n    font-size: 26rpx;\n    transition: all 0.2s;\n    \n    &:active {\n      opacity: 0.9;\n      transform: scale(0.98);\n    }\n  }\n  \n  .reset-btn {\n    background: #f0f2f5;\n    color: #606266;\n  }\n  \n  .confirm-btn {\n    background: #4369f4;\n    color: white;\n  }\n}\n\n\n.floating-actions {\n  position: fixed;\n  right: 40rpx;\n  bottom: 120rpx;\n}\n\n.fab-button {\n  width: 88rpx;\n  height: 88rpx;\n  border-radius: 24rpx;\n  box-shadow: 0 6rpx 18rpx rgba(66, 133, 244, 0.3);\n  \n  .fab-icon {\n    font-size: 40rpx;\n  }\n}\n\n\n.fab-icon {\n  font-size: 48rpx;\n}\n\n.loading-overlay {\n  /* 原有加载样式 */\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/partner/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","dayjs","nextTick","uni","http","watch","onShow","onMounted","MiniProgramPage"],"mappings":"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"}