{"version":3,"file":"my_review.js","sources":["pages/my/my_review.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXkvbXlfcmV2aWV3LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 内容区域 -->\n    <view class=\"content\">\n      <empty-state\n        v-if=\"!isLoading && reviews.length === 0\"\n        description=\"您还没有发表过任何评论\"\n      />\n      <card-list\n        v-else\n        :items=\"reviews\"\n        type=\"review\"\n        show-delete\n        @delete=\"handleDelete\"\n      />\n    </view>\n\n    <!-- 加载状态 -->\n    <loading-overlay :visible=\"isLoading\" />\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { http, ENV_CONFIG } from '@/api/http';\nimport CardList from '@/components/CardList.vue';\nimport EmptyState from '@/components/EmptyState.vue';\nimport LoadingOverlay from '@/components/LoadingOverlay.vue';\n\nconst reviews = ref([]);\nconst isLoading = ref(false);\n\n// 获取用户评论列表\nconst fetchReviews = async () => {\n   try {\r\n       isLoading.value = true;\r\n       const response = await http.get('/api/user/reviews');\r\n       \r\n       reviews.value = response.data.map(review => {\r\n                // 确保使用后端返回的 images 字段\r\n                const processed = {\r\n                  ...review,\r\n\t\t\t\t  id: review.reviewId,\r\n                  images: review.images.map(img => { // 使用正确的字段名\r\n                    const processedUrl = img.startsWith('http') ? img : `${ENV_CONFIG[process.env.NODE_ENV]}${img}`;\r\n                    return processedUrl;\r\n                  })\r\n                };\r\n                return processed;\r\n              });\r\n     } catch (error) {\n    console.error('获取评论失败:', error);\n    uni.showToast({ title: '数据加载失败', icon: 'none' });\n  } finally {\n    isLoading.value = false;\n  }\n};\n\n// 处理删除操作\nconst handleDelete = async (item) => {\n  try {\n    const { confirm } = await uni.showModal({\n      title: '确认删除',\n      content: '确定要删除这条评论吗？删除后不可恢复',\n    });\n    \n    if (!confirm) return;\n\n    await http.delete(`/api/user/reviews/${item.id}`);\n    reviews.value = reviews.value.filter(r => r.id !== item.id);\n    uni.showToast({ title: '删除成功', icon: 'success' });\n  } catch (error) {\n    console.error('删除失败:', error);\n    uni.showToast({ title: '删除失败', icon: 'none' });\n  }\n};\n\n// 跳转到点评页面\nconst navigateToReview = () => {\n  uni.navigateTo({\n    url: '/pages/review/review'\n  });\n};\n\nonMounted(() => {\n  fetchReviews();\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  padding: 32rpx;\n  min-height: 100vh;\n  background-color: #f8f9fb;\n}\n\n.content {\n  margin-top: 24rpx;\n}\r\n::v-deep .delete-button {\n  background: #007aff !important;\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/my/my_review.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","http","ENV_CONFIG","uni","onMounted"],"mappings":";;;;;;AAyBA,MAAA,WAAqB,MAAA;AACrB,MAAA,aAAuB,MAAA;AACvB,MAAA,iBAA2B,MAAA;;;;AAErB,UAAA,UAAUA,kBAAI,CAAA,CAAE;AAChB,UAAA,YAAYA,kBAAI,KAAK;AAG3B,UAAM,eAAe,YAAY;AAC1B,UAAA;AACA,kBAAU,QAAQ;AAClB,cAAM,WAAW,MAAMC,SAAAA,KAAK,IAAI,mBAAmB;AAEnD,gBAAQ,QAAQ,SAAS,KAAK,IAAI,CAAU,WAAA;AAEnC,gBAAM,YAAY;AAAA,YAChB,GAAG;AAAA,YACf,IAAI,OAAO;AAAA,YACC,QAAQ,OAAO,OAAO,IAAI,CAAO,QAAA;AACzB,oBAAA,eAAe,IAAI,WAAW,MAAM,IAAI,MAAM,GAAGC,SAAW,WAAA,aAAoB,CAAC,GAAG,GAAG;AACtF,qBAAA;AAAA,YAAA,CACR;AAAA,UAAA;AAEI,iBAAA;AAAA,QAAA,CACR;AAAA,eACD,OAAO;AACjBC,sBAAA,MAAA,MAAA,SAAA,gCAAc,WAAW,KAAK;AAC9BA,sBAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,MAAA,UAC/C;AACA,kBAAU,QAAQ;AAAA,MACpB;AAAA,IAAA;AAII,UAAA,eAAe,OAAO,SAAS;AAC/B,UAAA;AACF,cAAM,EAAE,QAAA,IAAY,MAAMA,cAAAA,MAAI,UAAU;AAAA,UACtC,OAAO;AAAA,UACP,SAAS;AAAA,QAAA,CACV;AAED,YAAI,CAAC;AAAS;AAEd,cAAMF,SAAAA,KAAK,OAAO,qBAAqB,KAAK,EAAE,EAAE;AACxC,gBAAA,QAAQ,QAAQ,MAAM,OAAO,OAAK,EAAE,OAAO,KAAK,EAAE;AAC1DE,sBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAAA,eACzC,OAAO;AACdA,sBAAA,qDAAc,SAAS,KAAK;AAC5BA,sBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC/C;AAAA,IAAA;AAUFC,kBAAAA,UAAU,MAAM;AACD;IAAA,CACd;;;;;;;;;;;;;;;;;;;;;;;;;ACrFD,GAAG,WAAW,eAAe;"}