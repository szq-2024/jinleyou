{"version":3,"file":"my_comments.js","sources":["pages/my/my_comments.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbXkvbXlfY29tbWVudHMudnVl"],"sourcesContent":["<!-- /pages/my/my-comments.vue -->\n<template>\n  <view class=\"comments-container\">\n    <!-- 导航栏 -->\n    <uni-nav-bar \n      title=\"我的评论\" \n      left-icon=\"back\" \n      @clickLeft=\"back\"\n      :border=\"false\"\n      fixed\n    />\n    \n    <!-- 评论列表 -->\n    <scroll-view \n      scroll-y \n      class=\"comment-list\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"onRefresh\"\n      @scrolltolower=\"loadMore\"\n    >\n      <!-- 评论项 -->\n      <view \n        v-for=\"(item, index) in comments\" \n        :key=\"item.id\" \n        class=\"comment-item\"\n      >\n        <view class=\"comment-header\">\n          <image \n            class=\"avatar\" \n            :src=\"item.user.avatar || '/static/default-avatar.png'\" \n            mode=\"aspectFill\" \n          />\n          <view class=\"user-info\">\n            <text class=\"username\">{{ item.user.nickname }}</text>\n            <text class=\"time\">{{ formatTime(item.create_time) }}</text>\n          </view>\n          <view class=\"delete-btn\" @click.stop=\"showDeleteDialog(item.id, index)\">\n            <uni-icons type=\"trash\" size=\"18\" color=\"#999\"></uni-icons>\n          </view>\n        </view>\n        \n        <view class=\"comment-content\">\n          <text>{{ item.content }}</text>\n        </view>\n        \n        <view class=\"comment-footer\" @click=\"toTarget(item.target_id, item.type)\">\n          <text class=\"target\">评论于: {{ getTargetType(item.type) }}</text>\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#999\"></uni-icons>\n        </view>\n      </view>\n      \n      <!-- 加载状态 -->\n      <view class=\"loading-state\">\n        <text v-if=\"loading\" class=\"loading-text\">加载中...</text>\n        <text v-if=\"noMore\" class=\"no-more-text\">没有更多了</text>\n      </view>\n      \n      <!-- 空状态 -->\n      <view v-if=\"comments.length === 0 && !loading\" class=\"empty-container\">\n        <image src=\"/static/empty-comment.png\" class=\"empty-image\" />\n        <text class=\"empty-text\">暂无评论记录</text>\n        <button class=\"refresh-btn\" @click=\"loadComments\">重新加载</button>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\nimport { formatTime } from '@/utils/util.js';\n\nexport default {\n  data() {\n    return {\n      comments: [],\n      page: 1,\n      pageSize: 10,\n      loading: false,\n      noMore: false,\n      refreshing: false\n    };\n  },\n  onLoad() {\n    this.loadComments();\n  },\n  methods: {\n    // 加载评论\n    async loadComments() {\n      if (this.loading) return;\n      \n      this.loading = true;\n      try {\n        const res = await uni.request({\n          url: '/api/comments/my',\n          method: 'GET',\n          data: {\n            page: this.page,\n            page_size: this.pageSize\n          },\n          header: {\n            'Authorization': uni.getStorageSync('token')\n          }\n        });\n        \n        if (res.data.code === 200) {\n          const data = res.data.data;\n          this.comments = this.page === 1 ? data.list : [...this.comments, ...data.list];\n          this.noMore = data.list.length < this.pageSize;\n        }\n      } catch (error) {\n        console.error('获取评论失败:', error);\n        uni.showToast({\n          title: '获取评论失败',\n          icon: 'none'\n        });\n      } finally {\n        this.loading = false;\n        this.refreshing = false;\n      }\n    },\n    \n    // 下拉刷新\n    onRefresh() {\n      this.refreshing = true;\n      this.page = 1;\n      this.loadComments();\n    },\n    \n    // 上拉加载更多\n    loadMore() {\n      if (this.loading || this.noMore) return;\n      this.page++;\n      this.loadComments();\n    },\n    \n    // 显示删除确认对话框\n    showDeleteDialog(commentId, index) {\n      uni.showModal({\n        title: '提示',\n        content: '确定要删除这条评论吗？',\n        success: async (res) => {\n          if (res.confirm) {\n            await this.deleteComment(commentId, index);\n          }\n        }\n      });\n    },\n    \n    // 删除评论\n    async deleteComment(commentId, index) {\n      try {\n        const res = await uni.request({\n          url: `/api/comments/${commentId}`,\n          method: 'DELETE',\n          header: {\n            'Authorization': uni.getStorageSync('token')\n          }\n        });\n        \n        if (res.data.code === 200) {\n          uni.showToast({\n            title: '删除成功'\n          });\n          this.comments.splice(index, 1);\n        }\n      } catch (error) {\n        console.error('删除评论失败:', error);\n        uni.showToast({\n          title: '删除失败',\n          icon: 'none'\n        });\n      }\n    },\n    \n    // 跳转到评论目标\n    toTarget(targetId, type) {\n      let url = '';\n      switch (type) {\n        case 'article':\n          url = `/pages/article/detail?id=${targetId}`;\n          break;\n        case 'product':\n          url = `/pages/product/detail?id=${targetId}`;\n          break;\n        // 其他类型...\n        default:\n          return;\n      }\n      uni.navigateTo({ url });\n    },\n    \n    // 获取评论目标类型\n    getTargetType(type) {\n      const types = {\n        article: '文章',\n        product: '商品',\n        video: '视频'\n        // 其他类型...\n      };\n      return types[type] || '未知类型';\n    },\n    \n    // 格式化时间\n    formatTime,\n    \n    // 返回\n    back() {\n      uni.navigateBack();\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.comments-container {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background-color: #f5f5f5;\n  \n  .comment-list {\n    flex: 1;\n    padding: 20rpx;\n    \n    .comment-item {\n      background-color: #fff;\n      border-radius: 12rpx;\n      padding: 24rpx;\n      margin-bottom: 20rpx;\n      box-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.05);\n      \n      .comment-header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 20rpx;\n        \n        .avatar {\n          width: 80rpx;\n          height: 80rpx;\n          border-radius: 50%;\n          margin-right: 20rpx;\n        }\n        \n        .user-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          \n          .username {\n            font-size: 28rpx;\n            font-weight: bold;\n            margin-bottom: 6rpx;\n          }\n          \n          .time {\n            font-size: 24rpx;\n            color: #999;\n          }\n        }\n        \n        .delete-btn {\n          padding: 10rpx;\n        }\n      }\n      \n      .comment-content {\n        font-size: 28rpx;\n        line-height: 1.6;\n        margin-bottom: 20rpx;\n        color: #333;\n      }\n      \n      .comment-footer {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding-top: 16rpx;\n        border-top: 1rpx solid #f0f0f0;\n        \n        .target {\n          font-size: 24rpx;\n          color: #999;\n        }\n      }\n    }\n    \n    .loading-state {\n      text-align: center;\n      padding: 30rpx 0;\n      \n      .loading-text {\n        font-size: 26rpx;\n        color: #999;\n      }\n      \n      .no-more-text {\n        font-size: 26rpx;\n        color: #ccc;\n      }\n    }\n    \n    .empty-container {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding-top: 100rpx;\n      \n      .empty-image {\n        width: 300rpx;\n        height: 300rpx;\n        margin-bottom: 30rpx;\n      }\n      \n      .empty-text {\n        font-size: 28rpx;\n        color: #999;\n        margin-bottom: 40rpx;\n      }\n      \n      .refresh-btn {\n        width: 200rpx;\n        height: 70rpx;\n        line-height: 70rpx;\n        font-size: 28rpx;\n        background-color: #007aff;\n        color: #fff;\n        border-radius: 35rpx;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/my/my_comments.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","formatTime"],"mappings":"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"}