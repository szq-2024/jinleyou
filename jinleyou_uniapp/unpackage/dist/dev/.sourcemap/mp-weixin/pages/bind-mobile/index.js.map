{"version":3,"file":"index.js","sources":["pages/bind-mobile/index.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYmluZC1tb2JpbGUvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"auth-header\">\n      <text class=\"title\">绑定手机号</text>\n    </view>\n\n    <view class=\"form-container\">\n      <!-- 手机号输入 -->\n      <view class=\"form-item\" :class=\"{ error: errors.phone }\">\n        <uni-icons type=\"phone\" size=\"20\" color=\"#2867CE\" />\n        <input\n          v-model=\"form.phone\"\n          placeholder=\"请输入手机号\"\n          placeholder-class=\"placeholder\"\n          maxlength=\"11\"\n          @focus=\"resetError('phone')\"\n        />\n      </view>\n      <text v-if=\"errors.phone\" class=\"error-tip\">{{ errors.phone }}</text>\n\n      <!-- 密码输入 -->\n      <view class=\"form-item\" :class=\"{ error: errors.password }\">\n        <uni-icons type=\"locked\" size=\"20\" color=\"#2867CE\" />\n        <input\n          v-model=\"form.password\"\n          placeholder=\"请设置登录密码（至少6位）\"\n          placeholder-class=\"placeholder\"\n          :password=\"!showPassword\"\n          maxlength=\"20\"\n          @focus=\"resetError('password')\"\n        />\n        <view class=\"eye-icon\" @click=\"showPassword = !showPassword\">\n          <uni-icons :type=\"showPassword ? 'eye' : 'eye-slash'\" size=\"20\" color=\"#2867CE\" />\n        </view>\n      </view>\n      <text v-if=\"errors.password\" class=\"error-tip\">{{ errors.password }}</text>\n\n      <!-- 算式验证码 -->\n      <view class=\"form-item\" :class=\"{ error: errors.captcha }\">\n        <uni-icons type=\"chat\" size=\"20\" color=\"#2867CE\" />\n        <text class=\"captcha-problem\">{{ captchaProblem }}</text>\n        <input\n          v-model=\"form.captcha\"\n          placeholder=\"请输入计算结果\"\n          placeholder-class=\"placeholder\"\n          maxlength=\"2\"\n          @focus=\"resetError('captcha')\"\n        />\n        <view class=\"refresh-icon\" @click=\"generateMathProblem\">\n          <uni-icons type=\"refresh\" size=\"20\" color=\"#2867CE\" />\n        </view>\n      </view>\n      <text v-if=\"errors.captcha\" class=\"error-tip\">{{ errors.captcha }}</text>\n\n      <button\n        class=\"submit-btn\"\n        :class=\"{ disabled: !formValid }\"\n        :disabled=\"!formValid || loading\"\n        @click=\"handleSubmit\"\n      >\n        <text v-if=\"!loading\">立即绑定</text>\n        <uni-load-more v-else status=\"loading\" :icon-size=\"16\" />\n      </button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { http } from '@/api/http'\n\nexport default {\n  data() {\n    return {\n      form: {\n        phone: '',\n        password: '',\n        captcha: ''\n      },\n      errors: {\n        phone: '',\n        password: '',\n        captcha: ''\n      },\n      captchaProblem: '',\n      captchaAnswer: 0,\n      showPassword: false,\n      loading: false\n    }\n  },\n  computed: {\n    formValid() {\n      return (\n        this.form.phone &&\n        this.form.password &&\n        this.form.captcha &&\n        !Object.values(this.errors).some(err => err)\n      )\n    }\n  },\n  created() {\n    this.generateMathProblem()\n  },\n  methods: {\n    generateMathProblem() {\n      let num1, num2, operator\n      do {\n        num1 = Math.floor(Math.random() * 10) + 1\n        num2 = Math.floor(Math.random() * 10) + 1\n        operator = Math.random() < 0.5 ? '+' : '-'\n        if (operator === '-' && num1 < num2) [num1, num2] = [num2, num1]\n      } while (operator === '-' && num1 - num2 < 0)\n\n      this.captchaProblem = `${num1} ${operator} ${num2} = ?`\n      this.captchaAnswer = operator === '+' ? num1 + num2 : num1 - num2\n    },\n    validate() {\n      let valid = true\n      \n      // 手机号验证\n      if (!this.form.phone) {\n        this.errors.phone = '请输入手机号'\n        valid = false\n      } else if (!/^1[3-9]\\d{9}$/.test(this.form.phone)) {\n        this.errors.phone = '手机号格式不正确'\n        valid = false\n      }\n\n      // 密码验证\n      if (!this.form.password) {\n        this.errors.password = '请输入密码'\n        valid = false\n      } else if (this.form.password.length < 6) {\n        this.errors.password = '密码至少6位'\n        valid = false\n      }\n\n      // 验证码验证\n      if (!this.form.captcha) {\n        this.errors.captcha = '请输入验证码'\n        valid = false\n      } else if (parseInt(this.form.captcha) !== this.captchaAnswer) {\n        this.errors.captcha = '验证码错误'\n        valid = false\n      }\n\n      return valid\n    },\n    resetError(field) {\n      this.errors[field] = ''\n    },\n    async handleSubmit() {\n      if (!this.validate()) return\n\n      this.loading = true\n      try {\n        const res = await http.post('/api/auth/bind-mobile', {\n          phone: this.form.phone,\n          password: this.form.password,\n          captchaProblem: this.captchaProblem,\n          captchaAnswer: this.form.captcha,\n          userId: this.$store.state.user.userId // 从Vuex获取当前用户ID\n        })\r\n\t\tconst result = res || {}\n        if (res.code === 200) {\r\n\t\t\t  if (res.token) { // 合并账号情况\r\n\t\t\t    store.commit('updateToken', res.token);\r\n\t\t\t  }\n          uni.showToast({\n            title: '绑定成功',\n            icon: 'success',\n            complete: () => {\n              uni.switchTab({ url: '/pages/index/index' })\n            }\n          })\n        } else {\n          uni.showToast({\n            title: result.message || '绑定失败',\n            icon: 'none'\n          })\n        }\n      } catch (error) {\n        console.error('绑定失败:', error)\n        uni.showToast({\n          title: error.message || '网络错误，请重试',\n          icon: 'none'\n        })\n      } finally {\n        this.loading = false\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  padding: 60rpx 50rpx;\n  \n  .auth-header {\n    margin-bottom: 60rpx;\n    .title {\n      font-size: 36rpx;\n      font-weight: bold;\n      color: #333;\n    }\n  }\n\n  .form-container {\n    .form-item {\n      display: flex;\n      align-items: center;\n      padding: 25rpx 0;\n      border-bottom: 1rpx solid #e5e5e5;\n      margin-bottom: 10rpx;\n\n      &.error {\n        border-bottom-color: #ff5a5f;\n      }\n\n      input {\n        flex: 1;\n        margin-left: 20rpx;\n        font-size: 28rpx;\n        height: 50rpx;\n      }\n\n      .refresh-icon {\n        padding: 10rpx;\n        margin-left: 10rpx;\n      }\n    }\n\n    .error-tip {\n      color: #ff5a5f;\n      font-size: 24rpx;\n      margin-bottom: 20rpx;\n      display: block;\n      height: 40rpx;\n    }\n\n    .submit-btn {\n      margin-top: 80rpx;\n      height: 90rpx;\n      line-height: 90rpx;\n      font-size: 32rpx;\n      border-radius: 45rpx;\n      background-color: #2867CE;\n      color: #fff;\n\n      &.disabled {\n        background-color: #ccc;\n        opacity: 0.7;\n      }\n    }\n  }\n\n  .captcha-problem {\n    margin: 0 15rpx;\n    font-weight: bold;\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/bind-mobile/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["http","uni"],"mappings":"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"}