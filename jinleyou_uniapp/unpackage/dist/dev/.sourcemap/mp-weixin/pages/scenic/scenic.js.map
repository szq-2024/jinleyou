{"version":3,"file":"scenic.js","sources":["pages/scenic/scenic.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2NlbmljL3NjZW5pYy52dWU"],"sourcesContent":["<template>\n\t<view class=\"scenic-detail-container\">\n\t\t\n\t\t<!-- 图片轮播区 -->\n\t\t<swiper class=\"image-swiper\" indicator-dots autoplay circular>\n\t\t\t<swiper-item v-for=\"(img, index) in scenicData.images\" :key=\"index\">\n\t\t\t\t<image class=\"swiper-image\" :src=\"img\" mode=\"aspectFill\" />\n\t\t\t</swiper-item>\n\t\t</swiper>\n\n\t\t<!-- 景点基本信息 -->\n\t\t<view class=\"basic-info\">\n\t\t\t<view class=\"title-section\">\n\t\t\t\t<text class=\"scenic-name\">{{ scenicData.name }}</text>\n\t\t\t</view>\n\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<uni-icons type=\"location-filled\" size=\"18\" color=\"#666\"></uni-icons>\n\t\t\t\t<text class=\"info-text\">{{ scenicData.address }}</text>\n\t\t\t</view>\n\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<uni-icons type=\"clock\" size=\"18\" color=\"#666\"></uni-icons>\n\t\t\t\t<text class=\"info-text\">{{ scenicData.openTime }}</text>\n\t\t\t</view>\n\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<uni-icons type=\"money\" size=\"18\" color=\"#666\"></uni-icons>\n\t\t\t\t<text class=\"info-text\">{{ scenicData.ticketPrice }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 景点介绍 -->\n\t\t<view class=\"section\">\n\t\t\t<view class=\"section-title\">\n\t\t\t\t<text>景点介绍</text>\n\t\t\t</view>\n\t\t\t<view class=\"section-content\">\n\t\t\t\t<text class=\"description\">{{ scenicData.description }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 用户评价 -->\n\t\t<view class=\"section\">\n\t\t\t<view class=\"section-title\">\n\t\t\t\t<text>用户评价</text>\n\t\t\t</view>\n\n\t\t\t<!-- 评价列表 -->\n\t\t\t<view class=\"review-list\">\n\t\t\t\t<view class=\"review-item\" v-for=\"(review, index) in scenicData.reviews\" :key=\"index\">\n\t\t\t\t\t<image class=\"user-avatar\" :src=\"review.avatar\" mode=\"aspectFill\" />\n\t\t\t\t\t<view class=\"review-content\">\n\t\t\t\t\t\t<view class=\"user-info\">\n\t\t\t\t\t\t\t<text class=\"username\">{{ review.username }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"review-text\">{{ review.content }}</text>\n\t\t\t\t\t\t<text class=\"review-time\">{{ formatTime(review.time) }}</text>\n\n\t\t\t\t\t\t<!-- 评论图片 -->\n\t\t\t\t\t\t<view class=\"review-images\" v-if=\"review.images.length > 0\">\n\t\t\t\t\t\t\t<image \n\t\t\t\t\t\t\t\tv-for=\"(img, imgIndex) in review.images\" \n\t\t\t\t\t\t\t\t:key=\"imgIndex\"\n\t\t\t\t\t\t\t\tclass=\"review-image\"\n\t\t\t\t\t\t\t\t:src=\"img\"\n\t\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t\t@click=\"previewImage(review.images, imgIndex)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 底部操作栏 -->\n\t\t<view class=\"action-bar\">\n\t\t\t<button class=\"action-btn review-btn\" @click=\"navigateToReview\">\r\n\t\t\t    <uni-icons type=\"compose\" size=\"20\" color=\"#fff\"></uni-icons>\r\n\t\t\t    <text>写评价</text>\r\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { onLoad, onUnload } from '@dcloudio/uni-app';\nimport { http, ENV_CONFIG } from '@/api/http';\n\nconst scenicId = ref(null);\nconst scenicData = ref({\n  images: [],\n  reviews: []\n});\nconst isCollected = ref(false);\nconst newReview = ref({\n  content: '',\n  images: []\n});\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\n// 格式化时间显示\nconst formatTime = (timeString) => {\n  if (!timeString) return '';\n  const date = new Date(timeString);\n  return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;\n};\n\n// 图片预览\nconst previewImage = (urls, index) => {\n  uni.previewImage({\n    current: index,\n    urls: urls\n  });\n};\n\n// 加载景点详情\nconst fetchDetail = async () => {\n  try {\n    const response = await http.get(`/api/scenic-spots/${scenicId.value}`);\n    const data = response.data;\n\n    // 处理评论数据\n    const parseReviews = (reviews) => {\r\n      return reviews.map(review => ({\r\n        ...review,\r\n        avatar: processImages([review.avatar])[0] || '/static/default-avatar.png', // 处理头像\r\n        images: processImages(review.images || []) // 处理评论图片\r\n      }));\r\n    };\n\t// 处理图片路径（假设后端已返回数组）\n    const processImages = (images) => {\r\n      return (Array.isArray(images) ? images : []).map(img => {\r\n        if (!img) return '/static/default-scenic.jpg';\r\n        // 判断是否是完整URL\r\n        if (img.startsWith('http') || img.startsWith('https')) {\r\n          return img;\r\n        }\r\n        // 拼接环境变量中的基地址\r\n        return `${ENV_CONFIG[process.env.NODE_ENV]}${img}`;\r\n      });\r\n    };\n    scenicData.value = {\n      ...data,\n      images: processImages(data.images),\n      reviews: parseReviews(data.reviews)\n    };\n\n  } catch (error) {\n    uni.showToast({ title: '数据加载失败', icon: 'none' });\n  }\n};\nconst navigateToReview = () => {\n  uni.navigateTo({\n    url: `/pages/review/review?id=${scenicId.value}`\n  });\n};\r\nonMounted(() => {\n  uni.$on('review-submitted', fetchDetail);\n});\n\n\nonLoad((options) => {\n  scenicId.value = options.id;\n  fetchDetail();\n});\r\nonUnload(() => {\n  uni.$off('review-submitted');\n});\n</script>\n\n<style lang=\"scss\">\n.scenic-detail-container {\n  padding-bottom: 100rpx;\n  background-color: #f5f5f5;\n\n  .image-swiper {\n    width: 100%;\n    height: 500rpx;\n\n    .swiper-image {\n      width: 100%;\n      height: 100%;\n    }\n  }\n\n  .basic-info {\n    padding: 30rpx;\n    background-color: #fff;\n    margin-bottom: 20rpx;\n\n    .title-section {\n      margin-bottom: 30rpx;\n\n      .scenic-name {\n        font-size: 36rpx;\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 10rpx;\n        display: block;\n      }\n    }\n\n    .info-row {\n      display: flex;\n      align-items: center;\n      margin-bottom: 20rpx;\n\n      .info-text {\n        font-size: 28rpx;\n        color: #666;\n        margin-left: 10rpx;\n      }\n    }\n  }\n\n  .section {\n    background-color: #fff;\n    margin-bottom: 20rpx;\n    padding: 30rpx;\n\n    .section-title {\n      font-size: 32rpx;\n      font-weight: bold;\n      color: #333;\n      margin-bottom: 30rpx;\n    }\n\n    .section-content {\n      .description {\n        font-size: 28rpx;\n        color: #666;\n        line-height: 1.6;\n      }\n    }\n\n    .review-list {\n      .review-item {\n        display: flex;\n        padding: 30rpx 0;\n        border-bottom: 1rpx solid #f5f5f5;\n\n        .user-avatar {\n          width: 80rpx;\n          height: 80rpx;\n          border-radius: 50%;\n          margin-right: 20rpx;\n        }\n\n        .review-content {\n          flex: 1;\n\n          .user-info {\n            margin-bottom: 15rpx;\n\n            .username {\n              font-size: 28rpx;\n              color: #333;\n              margin-right: 15rpx;\n            }\n          }\n\n          .review-text {\n            font-size: 28rpx;\n            color: #333;\n            line-height: 1.5;\n            margin-bottom: 15rpx;\n          }\n\n          .review-time {\n            font-size: 24rpx;\n            color: #999;\n            display: block;\n            margin-bottom: 15rpx;\n          }\n\n          .review-images {\n            display: flex;\n            flex-wrap: wrap;\n\n            .review-image {\n              width: 200rpx;\n              height: 200rpx;\n              border-radius: 8rpx;\n              margin-right: 15rpx;\n              margin-bottom: 15rpx;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  .action-bar {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 100rpx;\n    background-color: #fff;\n    display: flex;\n    align-items: center;\n    box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n\n    .action-btn {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 80rpx;\n      font-size: 28rpx;\n      border-radius: 0;\n      border: none;\n\n      &.collect-btn {\n        background-color: #fff;\n        color: #666;\n      }\n\n      &.review-btn {\n        background-color: #2867CE;\n        color: #fff;\n        margin: 0 20rpx;\n        border-radius: 40rpx;\n      }\n    }\n  }\n\n  .review-modal {\n    background-color: #fff;\n    padding: 30rpx;\n    border-radius: 20rpx 20rpx 0 0;\n\n    .modal-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 30rpx;\n\n      .modal-title {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: #333;\n      }\n    }\n\n    .review-textarea {\n      width: 100%;\n      min-height: 200rpx;\n      padding: 20rpx;\n      background-color: #f5f5f5;\n      border-radius: 12rpx;\n      font-size: 28rpx;\n      margin-bottom: 30rpx;\n    }\n\n    .submit-btn {\n      background-color: #007aff;\n      color: #fff;\n      height: 80rpx;\n      line-height: 80rpx;\n      border-radius: 40rpx;\n      font-size: 30rpx;\n    }\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/scenic/scenic.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","http","ENV_CONFIG","onMounted","onLoad","onUnload","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;AA0FM,UAAA,WAAWA,kBAAI,IAAI;AACzB,UAAM,aAAaA,cAAAA,IAAI;AAAA,MACrB,QAAQ,CAAC;AAAA,MACT,SAAS,CAAC;AAAA,IAAA,CACX;AACmBA,kBAAAA,IAAI,KAAK;AACXA,sBAAI;AAAA,MACpB,SAAS;AAAA,MACT,QAAQ,CAAC;AAAA,IAAA,CACV;AAQK,UAAA,aAAa,CAAC,eAAe;AACjC,UAAI,CAAC;AAAmB,eAAA;AAClB,YAAA,OAAO,IAAI,KAAK,UAAU;AACzB,aAAA,GAAG,KAAK,YAAA,CAAa,KAAK,KAAK,SAAS,IAAI,GAAG,SAAW,EAAA,SAAS,GAAG,GAAG,CAAC,IAAI,KAAK,QAAQ,EAAE,SAAW,EAAA,SAAS,GAAG,GAAG,CAAC;AAAA,IAAA;AAI3H,UAAA,eAAe,CAAC,MAAM,UAAU;AACpCC,oBAAAA,MAAI,aAAa;AAAA,QACf,SAAS;AAAA,QACT;AAAA,MAAA,CACD;AAAA,IAAA;AAIH,UAAM,cAAc,YAAY;AAC1B,UAAA;AACF,cAAM,WAAW,MAAMC,SAAAA,KAAK,IAAI,qBAAqB,SAAS,KAAK,EAAE;AACrE,cAAM,OAAO,SAAS;AAGhB,cAAA,eAAe,CAAC,YAAY;AACzB,iBAAA,QAAQ,IAAI,CAAW,YAAA;AAAA,YAC5B,GAAG;AAAA,YACH,QAAQ,cAAc,CAAC,OAAO,MAAM,CAAC,EAAE,CAAC,KAAK;AAAA;AAAA,YAC7C,QAAQ,cAAc,OAAO,UAAU,CAAA,CAAE;AAAA;AAAA,UACzC,EAAA;AAAA,QAAA;AAGE,cAAA,gBAAgB,CAAC,WAAW;AACxB,kBAAA,MAAM,QAAQ,MAAM,IAAI,SAAS,CAAC,GAAG,IAAI,CAAO,QAAA;AACtD,gBAAI,CAAC;AAAY,qBAAA;AAEjB,gBAAI,IAAI,WAAW,MAAM,KAAK,IAAI,WAAW,OAAO,GAAG;AAC9C,qBAAA;AAAA,YACT;AAEA,mBAAO,GAAGC,SAAAA,WAAW,aAAoB,CAAC,GAAG,GAAG;AAAA,UAAA,CACjD;AAAA,QAAA;AAEH,mBAAW,QAAQ;AAAA,UACjB,GAAG;AAAA,UACH,QAAQ,cAAc,KAAK,MAAM;AAAA,UACjC,SAAS,aAAa,KAAK,OAAO;AAAA,QAAA;AAAA,eAG7B,OAAO;AACdF,sBAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAAA,MACjD;AAAA,IAAA;AAEF,UAAM,mBAAmB,MAAM;AAC7BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,2BAA2B,SAAS,KAAK;AAAA,MAAA,CAC/C;AAAA,IAAA;AAEHG,kBAAAA,UAAU,MAAM;AACVH,oBAAAA,MAAA,IAAI,oBAAoB,WAAW;AAAA,IAAA,CACxC;AAGDI,kBAAA,OAAO,CAAC,YAAY;AAClB,eAAS,QAAQ,QAAQ;AACb;IAAA,CACb;AACDC,kBAAAA,SAAS,MAAM;AACbL,0BAAI,KAAK,kBAAkB;AAAA,IAAA,CAC5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5KD,GAAG,WAAWM,SAAe;"}