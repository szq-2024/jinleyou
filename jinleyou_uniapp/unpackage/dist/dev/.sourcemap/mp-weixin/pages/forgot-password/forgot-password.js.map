{"version":3,"file":"forgot-password.js","sources":["pages/forgot-password/forgot-password.vue","../../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZm9yZ290LXBhc3N3b3JkL2ZvcmdvdC1wYXNzd29yZC52dWU"],"sourcesContent":["<template>\n  <view class=\"auth-container\">\n    <!-- 顶部logo -->\n    <view class=\"auth-header\">\n      <image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\" />\n      <text class=\"title\">找回密码</text>\n    </view>\n\n    <!-- 密码重置表单 -->\n    <view class=\"auth-form\">\n      <!-- 账号/手机号输入 -->\n      <view class=\"form-item\" :class=\"{ error: errors.account }\">\n        <uni-icons type=\"person\" size=\"20\" color=\"#2867CE\" />\n        <input\n          v-model=\"form.account\"\n          placeholder=\"请输入账号或手机号\"\n          placeholder-class=\"placeholder\"\n          @focus=\"resetError('account')\"\n        />\n      </view>\n      <text v-if=\"errors.account\" class=\"error-tip\">{{ errors.account }}</text>\n\n      <!-- 算式验证码 -->\n      <view class=\"form-item\" :class=\"{ error: errors.captcha }\">\n        <uni-icons type=\"chat\" size=\"20\" color=\"#2867CE\" />\n        <text class=\"captcha-problem\">{{ captchaProblem }}</text>\n        <input\n          v-model=\"form.captcha\"\n          placeholder=\"请输入计算结果\"\n          placeholder-class=\"placeholder\"\n          maxlength=\"2\"\n          @focus=\"resetError('captcha')\"\n        />\n        <view class=\"refresh-icon\" @click=\"generateMathProblem\">\n          <uni-icons type=\"refresh\" size=\"20\" color=\"#2867CE\" />\n        </view>\n      </view>\n      <text v-if=\"errors.captcha\" class=\"error-tip\">{{ errors.captcha }}</text>\n\n      <!-- 新密码 -->\n      <view class=\"form-item\" :class=\"{ error: errors.newPassword }\">\n        <uni-icons type=\"locked\" size=\"20\" color=\"#2867CE\" />\n        <input\n          v-model=\"form.newPassword\"\n          placeholder=\"请输入新密码（至少6位）\"\n          placeholder-class=\"placeholder\"\n          :password=\"!showPassword\"\n          @focus=\"resetError('newPassword')\"\n        />\n        <view class=\"eye-icon\" @click=\"showPassword = !showPassword\">\n          <uni-icons :type=\"showPassword ? 'eye' : 'eye-slash'\" size=\"20\" color=\"#2867CE\" />\n        </view>\n      </view>\n      <text v-if=\"errors.newPassword\" class=\"error-tip\">{{ errors.newPassword }}</text>\n\n      <!-- 确认密码 -->\n      <view class=\"form-item\" :class=\"{ error: errors.confirmPassword }\">\n        <uni-icons type=\"locked\" size=\"20\" color=\"#2867CE\" />\n        <input\n          v-model=\"form.confirmPassword\"\n          placeholder=\"请确认新密码\"\n          placeholder-class=\"placeholder\"\n          :password=\"!showPassword\"\n          @focus=\"resetError('confirmPassword')\"\n        />\r\n\t\t<view class=\"eye-icon\" @click=\"showPassword = !showPassword\">\r\n\t\t  <uni-icons :type=\"showPassword ? 'eye' : 'eye-slash'\" size=\"20\" color=\"#2867CE\" />\r\n\t\t</view>\n      </view>\n      <text v-if=\"errors.confirmPassword\" class=\"error-tip\">{{ errors.confirmPassword }}</text>\n\n      <!-- 提交按钮 -->\n      <button \n        class=\"auth-btn primary\"\n        :class=\"{ disabled: !formValid }\"\n        :disabled=\"!formValid || loading\"\n        @click=\"handleResetPassword\"\n      >\n        <text v-if=\"!loading\">重置密码</text>\n        <uni-load-more v-else status=\"loading\" :icon-size=\"16\" />\n      </button>\n\n      <!-- 返回登录 -->\n      <view class=\"auth-footer\">\n        <text class=\"link\" @click=\"navigateTo('/pages/login/login')\">返回登录</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { http } from '@/api/http'\n\nexport default {\n  data() {\n    return {\n      form: {\n        account: '',\n        captcha: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      errors: {\n        account: '',\n        captcha: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      captchaProblem: '',\n      captchaAnswer: 0,\n      showPassword: false,\n      loading: false\n    }\n  },\n  computed: {\n    formValid() {\n      return (\n        this.form.account &&\n        this.form.captcha &&\n        this.form.newPassword &&\n        this.form.confirmPassword &&\n        !Object.values(this.errors).some(err => err)\n      )\n    }\n  },\n  created() {\n    this.generateMathProblem()\n  },\n  methods: {\n    generateMathProblem() {\n      let num1, num2, operator\n      do {\n        num1 = Math.floor(Math.random() * 10) + 1\n        num2 = Math.floor(Math.random() * 10) + 1\n        operator = Math.random() < 0.5 ? '+' : '-'\n        if (operator === '-' && num1 < num2) {\n          [num1, num2] = [num2, num1]\n        }\n      } while (operator === '-' && num1 - num2 < 0)\n\n      this.captchaProblem = `${num1} ${operator} ${num2} = ?`\n      this.captchaAnswer = operator === '+' ? num1 + num2 : num1 - num2\n    },\n\n    validate() {\n      let valid = true\n      \n      // 账号验证\n      if (!this.form.account.trim()) {\n        this.errors.account = '请输入用户名或手机号'\n        valid = false\n      } else if (!/^(\\w{4,20}|1[3-9]\\d{9})$/.test(this.form.account)) {\n        this.errors.account = '格式不正确'\n        valid = false\n      }\n\n      // 验证码验证\n      if (!this.form.captcha) {\n        this.errors.captcha = '请输入验证码'\n        valid = false\n      } else if (parseInt(this.form.captcha) !== this.captchaAnswer) {\n        this.errors.captcha = '验证码错误'\n        valid = false\n      }\n\n      // 新密码验证\n      if (!this.form.newPassword) {\n        this.errors.newPassword = '请输入新密码'\n        valid = false\n      } else if (this.form.newPassword.length < 6) {\n        this.errors.newPassword = '密码至少6位'\n        valid = false\n      }\n\n      // 确认密码验证\n      if (!this.form.confirmPassword) {\n        this.errors.confirmPassword = '请确认密码'\n        valid = false\n      } else if (this.form.confirmPassword !== this.form.newPassword) {\n        this.errors.confirmPassword = '两次输入不一致'\n        valid = false\n      }\n\n      return valid\n    },\n\n    resetError(field) {\n      this.errors[field] = ''\n    },\n\n    async handleResetPassword() {\n      if (!this.validate()) return\n\n      this.loading = true\n      try {\n        const res = await http.post('/api/auth/reset-password', {\n          account: this.form.account,\n          newPassword: this.form.newPassword,\n          captchaProblem: this.captchaProblem,\n          captchaAnswer: this.form.captcha\n        })\n\n        if (res?.code === 200) {\n          uni.showToast({\n            title: '密码重置成功',\n            icon: 'success',\n            complete: () => {\n              this.navigateTo('/pages/login/login')\n            }\n          })\n        } else {\n          const message = res?.data?.message || '重置失败，请重试'\n          uni.showToast({ title: message, icon: 'none' })\n        }\n      } catch (error) {\n        console.error('密码重置失败:', error)\n        uni.showToast({\n          title: '网络错误，请稍后重试',\n          icon: 'none'\n        })\n      } finally {\n        this.loading = false\n      }\n    },\n\n    navigateTo(url) {\n      uni.navigateTo({ url })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.auth-container {\n\tpadding: 60rpx 50rpx;\n\tmin-height: 100vh;\n\tdisplay: flex;\n\tflex-direction: column;\n  \n\t.auth-header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tmargin-bottom: 80rpx;\n    \n\t\t.logo {\n\t\t\twidth: 150rpx;\n\t\t\theight: 150rpx;\n\t\t\tborder-radius: 30rpx;\n\t\t}\n    \n\t\t.title {\n\t\t\tfont-size: 40rpx;\n\t\t\tfont-weight: bold;\n\t\t\tmargin-top: 20rpx;\n\t\t\tcolor: #333;\n\t\t}\n\t}\n  \n\t.auth-form {\n\t\t.form-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tpadding: 25rpx 0;\n\t\t\tborder-bottom: 1rpx solid #e5e5e5;\n\t\t\tmargin-bottom: 10rpx;\n\t\t\tposition: relative;\n      \n\t\t\t&.error {\n\t\t\t\tborder-bottom-color: #ff5a5f;\n\t\t\t}\n      \n\t\t\tinput {\n\t\t\t\tflex: 1;\n\t\t\t\tmargin-left: 20rpx;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\theight: 50rpx;\n\t\t\t\tline-height: 50rpx;\n\t\t\t}\n      \n\t\t\t.placeholder {\n\t\t\t\tcolor: #ccc;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t}\n      \n\t\t\t.eye-icon {\n\t\t\t\tpadding: 10rpx;\n\t\t\t}\n\t\t}\n    \n\t\t.error-tip {\n\t\t\tcolor: #ff5a5f;\n\t\t\tfont-size: 24rpx;\n\t\t\tmargin-bottom: 20rpx;\n\t\t\tdisplay: block;\n\t\t\theight: 40rpx;\n\t\t}\n    \n\t\t.auth-btn {\n\t\t\tmargin-top: 60rpx;\n\t\t\theight: 90rpx;\n\t\t\tline-height: 90rpx;\n\t\t\tfont-size: 32rpx;\n\t\t\tborder-radius: 45rpx;\n\t\t\ttransition: all 0.3s;\n\t\t  \n\t\t\t&.primary {\n\t\t\t\tbackground-color: #2867CE;\n\t\t\t\tcolor: #fff;\n\t\t\t}\n\t\t  \n\t\t\t&.disabled {\n\t\t\t\tbackground-color: #ccc;\n\t\t\t\topacity: 0.7;\n\t\t\t}\n\t\t}\n    \n\t\t.auth-footer {\n\t\t\ttext-align: center;\n\t\t\tmargin-top: 30rpx;\n\t\t\tfont-size: 26rpx;\n\t\t\tcolor: #666;\n\t\t\t  \n\t\t\t.link {\n\t\t\t\tcolor: #2867CE;\n\t\t\t\tmargin-left: 10rpx;\n\t\t\t}\n\t\t}\r\n\t\t\r\n\t\t.captcha-problem {\r\n\t\t\tmargin: 0 10rpx;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\t\t.refresh-icon {\r\n\t\t\tpadding: 10rpx;\r\n\t\t\tmargin-left: 10rpx;\r\n\t\t}\n\t}\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_GitHub/jinleyou_uniapp/pages/forgot-password/forgot-password.vue'\nwx.createPage(MiniProgramPage)"],"names":["http","uni"],"mappings":";;;;AA6FA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,MAAM;AAAA,QACJ,SAAS;AAAA,QACT,SAAS;AAAA,QACT,aAAa;AAAA,QACb,iBAAiB;AAAA,MAClB;AAAA,MACD,QAAQ;AAAA,QACN,SAAS;AAAA,QACT,SAAS;AAAA,QACT,aAAa;AAAA,QACb,iBAAiB;AAAA,MAClB;AAAA,MACD,gBAAgB;AAAA,MAChB,eAAe;AAAA,MACf,cAAc;AAAA,MACd,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,YAAY;AACV,aACE,KAAK,KAAK,WACV,KAAK,KAAK,WACV,KAAK,KAAK,eACV,KAAK,KAAK,mBACV,CAAC,OAAO,OAAO,KAAK,MAAM,EAAE,KAAK,SAAO,GAAG;AAAA,IAE/C;AAAA,EACD;AAAA,EACD,UAAU;AACR,SAAK,oBAAoB;AAAA,EAC1B;AAAA,EACD,SAAS;AAAA,IACP,sBAAsB;AACpB,UAAI,MAAM,MAAM;AAChB,SAAG;AACD,eAAO,KAAK,MAAM,KAAK,OAAS,IAAE,EAAE,IAAI;AACxC,eAAO,KAAK,MAAM,KAAK,OAAS,IAAE,EAAE,IAAI;AACxC,mBAAW,KAAK,OAAO,IAAI,MAAM,MAAM;AACvC,YAAI,aAAa,OAAO,OAAO,MAAM;AACnC,WAAC,MAAM,IAAI,IAAI,CAAC,MAAM,IAAI;AAAA,QAC5B;AAAA,MACF,SAAS,aAAa,OAAO,OAAO,OAAO;AAE3C,WAAK,iBAAiB,GAAG,IAAI,IAAI,QAAQ,IAAI,IAAI;AACjD,WAAK,gBAAgB,aAAa,MAAM,OAAO,OAAO,OAAO;AAAA,IAC9D;AAAA,IAED,WAAW;AACT,UAAI,QAAQ;AAGZ,UAAI,CAAC,KAAK,KAAK,QAAQ,KAAI,GAAI;AAC7B,aAAK,OAAO,UAAU;AACtB,gBAAQ;AAAA,iBACC,CAAC,2BAA2B,KAAK,KAAK,KAAK,OAAO,GAAG;AAC9D,aAAK,OAAO,UAAU;AACtB,gBAAQ;AAAA,MACV;AAGA,UAAI,CAAC,KAAK,KAAK,SAAS;AACtB,aAAK,OAAO,UAAU;AACtB,gBAAQ;AAAA,iBACC,SAAS,KAAK,KAAK,OAAO,MAAM,KAAK,eAAe;AAC7D,aAAK,OAAO,UAAU;AACtB,gBAAQ;AAAA,MACV;AAGA,UAAI,CAAC,KAAK,KAAK,aAAa;AAC1B,aAAK,OAAO,cAAc;AAC1B,gBAAQ;AAAA,MACV,WAAW,KAAK,KAAK,YAAY,SAAS,GAAG;AAC3C,aAAK,OAAO,cAAc;AAC1B,gBAAQ;AAAA,MACV;AAGA,UAAI,CAAC,KAAK,KAAK,iBAAiB;AAC9B,aAAK,OAAO,kBAAkB;AAC9B,gBAAQ;AAAA,iBACC,KAAK,KAAK,oBAAoB,KAAK,KAAK,aAAa;AAC9D,aAAK,OAAO,kBAAkB;AAC9B,gBAAQ;AAAA,MACV;AAEA,aAAO;AAAA,IACR;AAAA,IAED,WAAW,OAAO;AAChB,WAAK,OAAO,KAAK,IAAI;AAAA,IACtB;AAAA,IAED,MAAM,sBAAsB;;AAC1B,UAAI,CAAC,KAAK,SAAQ;AAAI;AAEtB,WAAK,UAAU;AACf,UAAI;AACF,cAAM,MAAM,MAAMA,cAAK,KAAK,4BAA4B;AAAA,UACtD,SAAS,KAAK,KAAK;AAAA,UACnB,aAAa,KAAK,KAAK;AAAA,UACvB,gBAAgB,KAAK;AAAA,UACrB,eAAe,KAAK,KAAK;AAAA,SAC1B;AAED,aAAI,2BAAK,UAAS,KAAK;AACrBC,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU,MAAM;AACd,mBAAK,WAAW,oBAAoB;AAAA,YACtC;AAAA,WACD;AAAA,eACI;AACL,gBAAM,YAAU,gCAAK,SAAL,mBAAW,YAAW;AACtCA,wBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,QAChD;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAA,MAAA,SAAA,oDAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AAAA,MACH,UAAU;AACR,aAAK,UAAU;AAAA,MACjB;AAAA,IACD;AAAA,IAED,WAAW,KAAK;AACdA,0BAAI,WAAW,EAAE,KAAK;AAAA,IACxB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpOA,GAAG,WAAW,eAAe;"}