{"version":3,"file":"login.js","sources":["pages/login/login.vue","../Programming/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n\t<view class=\"auth-container\">\n\t\t<!-- 顶部logo -->\n\t\t<view class=\"auth-header\">\n\t\t\t<image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\" />\n\t\t\t<text class=\"title\">欢迎使用津乐游</text>\n\t\t</view>\n\n\t\t<!-- 登录表单 -->\n\t\t<view class=\"auth-form\">\r\n\t\t\t<!-- 用户名输入 -->\n\t\t\t<view class=\"form-item\" :class=\"{ error: errors.username }\">\n\t\t\t\t<uni-icons type=\"person\" size=\"20\" color=\"#2867CE\" />\n\t\t\t\t<input \n\t\t\t\t\tv-model=\"form.username\"\n\t\t\t\t\tplaceholder=\"请输入手机号/用户名\"\n\t\t\t\t\tplaceholder-class=\"placeholder\"\n\t\t\t\t\tmaxlength=\"20\"\n\t\t\t\t\t@focus=\"resetError('username')\"\n\t\t\t\t/>\n\t\t\t</view>\n\t\t\t<text v-if=\"errors.username\" class=\"error-tip\">{{ errors.username }}</text>\n\t\t\t<!-- 密码输入 -->\n\t\t\t<view class=\"form-item\" :class=\"{ error: errors.password }\">\n\t\t\t\t<uni-icons type=\"locked\" size=\"20\" color=\"#2867CE\" />\n\t\t\t\t<input\n\t\t\t\t\tv-model=\"form.password\"\n\t\t\t\t\tplaceholder=\"请输入密码\"\n\t\t\t\t\tplaceholder-class=\"placeholder\"\n\t\t\t\t\t:password=\"!showPassword\"\n\t\t\t\t\tmaxlength=\"20\"\n\t\t\t\t\t@focus=\"resetError('password')\"\n\t\t\t\t/>\n\t\t\t\t<view class=\"eye-icon\" @click=\"showPassword = !showPassword\">\n\t\t\t\t\t<uni-icons :type=\"showPassword ? 'eye' : 'eye-slash'\" size=\"20\" color=\"#2867CE\" />\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<text v-if=\"errors.password\" class=\"error-tip\">{{ errors.password }}</text>\n\t\t\t<!-- 表单操作 -->\n\t\t\t<view class=\"form-actions\">\n\t\t\t\t<view class=\"remember-me\">\n\t\t\t\t\t<checkbox-group @change=\"toggleRemember\">\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<checkbox :checked=\"rememberMe\" color=\"#2867CE\" />\n\t\t\t\t\t\t\t<text>记住我</text>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</checkbox-group>\n\t\t\t\t</view>\n\t\t\t\t<text class=\"forgot-password\" @click=\"navigateTo('/pages/forgot-password/index')\">忘记密码？</text>\n\t\t\t</view>\n\t\t\t<!-- 登录按钮 -->\n\t\t\t<button \n\t\t\t\tclass=\"auth-btn primary\"\n\t\t\t\t:class=\"{ disabled: !formValid }\"\n\t\t\t\t:disabled=\"!formValid || loading\"\n\t\t\t\t@click=\"handleLogin\"\n\t\t\t>\n\t\t\t\t<text v-if=\"!loading\">登 录</text>\n\t\t\t\t<uni-load-more v-else status=\"loading\" :icon-size=\"16\" />\n\t\t\t</button>\n\t\t\t<!-- 注册引导 -->\n\t\t\t<view class=\"auth-footer\">\n\t\t\t\t<text>还没有账号？</text>\n\t\t\t\t<text class=\"link\" @click=\"navigateTo('/pages/register/index')\">立即注册</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 第三方登录 -->\n\t\t<view class=\"social-login\">\n\t\t\t<view class=\"divider\">\n\t\t\t\t<text>或通过以下方式登录</text>\n\t\t\t</view>\n\t\t\t<view class=\"social-icons\">\n\t\t\t\t<button class=\"icon-btn\" open-type=\"getPhoneNumber\" @getphonenumber=\"onWechatLogin\">\n\t\t\t\t\t<uni-icons type=\"weixin\" size=\"24\" color=\"#09BB07\" />\n\t\t\t\t</button>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 协议声明 -->\n\t\t<view class=\"agreement\">\n\t\t\t<checkbox-group @change=\"toggleAgreement\">\n\t\t\t\t<label>\n\t\t\t\t\t<checkbox :checked=\"agreed\" color=\"#4cd964\" />\n\t\t\t\t\t<text>我已阅读并同意</text>\n\t\t\t\t</label>\n\t\t\t</checkbox-group>\n\t\t\t<text class=\"link\" @click=\"showAgreement\">《用户协议》</text>\n\t\t\t<text>和</text>\n\t\t\t<text class=\"link\" @click=\"showPrivacy\">《隐私政策》</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\r\nimport { http } from '@/api/http'\nimport { mapMutations } from 'vuex'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tform: {\n\t\t\t\tusername: '',\n\t\t\t\tpassword: ''\n\t\t\t},\n\t\t\terrors: {\n\t\t\t\tusername: '',\n\t\t\t\tpassword: ''\n\t\t\t},\n\t\t\tshowPassword: false,\n\t\t\trememberMe: false,\n\t\t\tagreed: true,\n\t\t\tloading: false\n\t\t}\n\t},\n\tcomputed: {\n\t\tformValid() {\n\t\t\treturn (\n\t\t\t\tthis.form.username && \n\t\t\t\tthis.form.password && \n\t\t\t\t!this.errors.username && \n\t\t\t\t!this.errors.password &&\n\t\t\t\tthis.agreed\n\t\t\t)\n\t\t}\n\t},\n\tonLoad() {\n\t\tthis.loadRememberedAccount()\n\t},\n\tmethods: {\n\t\t...mapMutations(\"user\", [\"SET_INFO\"]),\n    \n\t\t// 初始化记住的账号\n\t\tloadRememberedAccount() {\n\t\t\tconst account = uni.getStorageSync('rememberedAccount')\n\t\t\tif (account) {\n\t\t\t\tthis.form = { ...account }\n\t\t\t\tthis.rememberMe = true\n\t\t\t}\n\t\t},\n    \n\t\t// 验证表单\n\t\tvalidate() {\n\t\t\tlet valid = true\n\t\t\tconst { username, password } = this.form\n\t\t\tif (!username.trim()) {\n\t\t\t\tthis.errors.username = '请输入用户名/手机号'\n\t\t\t\tvalid = false\n\t\t\t} else if (!/^[\\w\\u4e00-\\u9fa5]{3,20}$/.test(username)) {\n\t\t\t\tthis.errors.username = '用户名格式不正确'\n\t\t\t\tvalid = false\n\t\t\t}\n      \n\t\t\tif (!password) {\n\t\t\t\tthis.errors.password = '请输入密码'\n\t\t\t\tvalid = false\n\t\t\t} else if (password.length < 6) {\n\t\t\t\tthis.errors.password = '密码长度至少6位'\n\t\t\t\tvalid = false\n\t\t\t}\n      \n\t\t\treturn valid\n\t\t},\n    \n\t\t// 重置错误\n\t\tresetError(field) {\n\t\t\tthis.errors[field] = ''\n\t\t},\n    \n\t\t// 记住账号\n\t\ttoggleRemember(e) {\n\t\t\tthis.rememberMe = e.detail.value.length > 0\n\t\t},\n    \n\t\t// 协议勾选\n\t\ttoggleAgreement(e) {\n\t\t\tthis.agreed = e.detail.value.length > 0\n\t\t},\n    \n\t\t// 处理登录\n\t\tasync handleLogin() {\r\n\t\t    if (!this.validate()) return;\r\n\t\t\r\n\t\t    this.loading = true;\r\n\t\t    try {\r\n\t\t        const res = await http.post('/api/auth/login', {\r\n\t\t            account: this.form.username,\r\n\t\t            password: this.form.password\r\n\t\t        });\r\n\t\t\t\tconsole.log('🔍 完整响应结构:', JSON.stringify(res, null, 2));\r\n\t\t        // 存储token和用户信息\r\n\t\t        uni.setStorageSync('token', res.data.token);\r\n\t\t        this.SET_INFO(res.data.user); \r\n\t\t\t\t// 新增：存储userId和avatar到本地存储\r\n\t\t\t\tuni.setStorageSync('userId', res.data.user.userId);\r\n\t\t\t\tuni.setStorageSync('avatar', res.data.user.avatar); // 同时存储头像\r\n\t\t\t\t// 假设后端返回expires_in，单位为秒\r\n\t\t\t\tconst expiresIn = res.data.expires_in;\r\n\t\t\t\tconst expireTime = Date.now() + expiresIn * 1000; // 转换为毫秒时间戳\r\n\t\t\t\tuni.setStorageSync('tokenExpire', expireTime);\r\n\t\t\r\n\t\t        // 显示成功提示\r\n\t\t        uni.showToast({\r\n\t\t                title: '登录成功',\r\n\t\t                icon: 'success',\r\n\t\t                duration: 1500,\r\n\t\t                success: () => { \r\n\t\t                    // 关键修改点：使用switchTab\r\n\t\t                    uni.switchTab({\r\n\t\t                        url: '/pages/index/index',\r\n\t\t                        success: () => {\r\n\t\t                            console.log('路由跳转成功');\r\n\t\t                        },\r\n\t\t                        fail: (err) => {\r\n\t\t                            console.error('路由跳转失败:', err);\r\n\t\t                            // 备用跳转方案\r\n\t\t                            uni.reLaunch({ \r\n\t\t                                url: '/pages/index/index' \r\n\t\t                            });\r\n\t\t                        }\r\n\t\t                    });\r\n\t\t                }\r\n\t\t            });\r\n\t\t\t\t\t\r\n\t\t\r\n\t\t        // 记住账号\r\n\t\t        if (this.rememberMe) {\r\n\t\t            uni.setStorageSync('rememberedAccount', this.form);\r\n\t\t        } else {\r\n\t\t            uni.removeStorageSync('rememberedAccount');\r\n\t\t        }\r\n\t\t\r\n\t\t    } catch (error) {\r\n\t\t        uni.showToast({\r\n\t\t            title: error.message || '登录失败',\r\n\t\t            icon: 'none'\r\n\t\t        });\r\n\t\t    } finally {\r\n\t\t        this.loading = false;\r\n\t\t    }\r\n\t\t},\n    \n\t\t// 微信登录\n\t\tonWechatLogin(e) {\n\t\t\tconsole.log('微信登录:', e)\n\t\t// 实际处理微信登录逻辑\n\t\t},\n    \n\t\t// 显示协议\n\t\tshowAgreement() {\n\t\t\tuni.navigateTo({ url: '/pages/webview?url=' + encodeURIComponent('https://localhost:3000/agreement') })\n\t\t},\n    \n\t\t// 显示隐私政策\n\t\tshowPrivacy() {\n\t\t\tuni.navigateTo({ url: '/pages/webview?url=' + encodeURIComponent('https://localhost:3000/privacy') })\n\t\t},\n    \n\t\t// 通用跳转\n\t\tnavigateTo(url) {\n\t\t\tuni.navigateTo({ url })\n\t\t}\n\t}\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.auth-container {\n\tpadding: 60rpx 50rpx;\n\tmin-height: 100vh;\n\tdisplay: flex;\n\tflex-direction: column;\n  \n\t.auth-header {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tmargin-bottom: 80rpx;\n    \n\t\t.logo {\n\t\t\twidth: 150rpx;\n\t\t\theight: 150rpx;\n\t\t\tborder-radius: 30rpx;\n\t\t}\n    \n\t\t.title {\n\t\t\tfont-size: 40rpx;\n\t\t\tfont-weight: bold;\n\t\t\tmargin-top: 20rpx;\n\t\t\tcolor: #333;\n\t\t}\n\t}\n  \n\t.auth-form {\n\t\t.form-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tpadding: 25rpx 0;\n\t\t\tborder-bottom: 1rpx solid #e5e5e5;\n\t\t\tmargin-bottom: 10rpx;\n\t\t\tposition: relative;\n      \n\t\t\t&.error {\n\t\t\t\tborder-bottom-color: #ff5a5f;\n\t\t\t}\n      \n\t\t\tinput {\n\t\t\t\tflex: 1;\n\t\t\t\tmargin-left: 20rpx;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t\theight: 50rpx;\n\t\t\t\tline-height: 50rpx;\n\t\t\t}\n      \n\t\t\t.placeholder {\n\t\t\t\tcolor: #ccc;\n\t\t\t\tfont-size: 28rpx;\n\t\t\t}\n      \n\t\t\t.eye-icon {\n\t\t\t\tpadding: 10rpx;\n\t\t\t}\n\t\t}\n    \n\t\t.error-tip {\n\t\t\tcolor: #ff5a5f;\n\t\t\tfont-size: 24rpx;\n\t\t\tmargin-bottom: 20rpx;\n\t\t\tdisplay: block;\n\t\t\theight: 40rpx;\n\t\t}\n    \n\t\t.form-actions {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tmargin-top: 30rpx;\n\t\t\tfont-size: 26rpx;\n      \n\t\t\t.remember-me {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n        \n\t\t\t\ttext {\n\t\t\t\t\tmargin-left: 10rpx;\n\t\t\t\t\tcolor: #666;\n\t\t\t\t}\n\t\t\t}\n      \n\t\t\t.forgot-password {\n\t\t\t\tcolor: #2867CE;\n\t\t\t}\n\t\t}\n    \n\t\t.auth-btn {\n\t\t\tmargin-top: 60rpx;\n\t\t\theight: 90rpx;\n\t\t\tline-height: 90rpx;\n\t\t\tfont-size: 32rpx;\n\t\t\tborder-radius: 45rpx;\n\t\t\ttransition: all 0.3s;\n      \n\t\t\t&.primary {\n\t\t\t\tbackground-color: #2867CE;\n\t\t\t\tcolor: #fff;\n\t\t\t}\n      \n\t\t\t&.disabled {\n\t\t\t\tbackground-color: #ccc;\n\t\t\t\topacity: 0.7;\n\t\t\t}\n\t\t}\n    \n\t\t.auth-footer {\n\t\t\ttext-align: center;\n\t\t\tmargin-top: 30rpx;\n\t\t\tfont-size: 26rpx;\n\t\t\tcolor: #666;\n      \n\t\t\t.link {\n\t\t\t\tcolor: #2867CE;\n\t\t\t\tmargin-left: 10rpx;\n\t\t\t}\n\t\t}\n\t}\n  \n\t.social-login {\n\t\tmargin-top: 80rpx;\n    \n\t\t.divider {\n\t\t\tposition: relative;\n\t\t\ttext-align: center;\n\t\t\tcolor: #999;\n\t\t\tfont-size: 26rpx;\n\t\t\tmargin-bottom: 40rpx;\n      \n\t\t\t&::before,\n\t\t\t&::after {\n\t\t\t\tcontent: '';\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 50%;\n\t\t\t\twidth: 100rpx;\n\t\t\t\theight: 1rpx;\n\t\t\t\tbackground-color: #e5e5e5;\n\t\t\t}\n      \n\t\t\t&::before {\n\t\t\t\tleft: 50rpx;\n\t\t\t}\n      \n\t\t\t&::after {\n\t\t\t\tright: 50rpx;\n\t\t\t}\n\t\t}\n    \n\t\t.social-icons {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\tgap: 80rpx;\n      \n\t\t\t.icon-btn {\n\t\t\t\twidth: 80rpx;\n\t\t\t\theight: 80rpx;\n\t\t\t\tborder-radius: 50%;\n\t\t\t\tbackground-color: #fff;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n\t\t\t\tpadding: 0;\n\t\t\t\tmargin: 0;\n\t\t\t\tborder: none;\n\t\t\t}\n\t\t}\n\t}\n  \n\t.agreement {\n\t\tmargin-top: auto;\n\t\tpadding-top: 40rpx;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tfont-size: 24rpx;\n\t\tcolor: #999;\n    \n\t\tcheckbox {\n\t\t\ttransform: scale(0.8);\n\t\t}\n    \n\t\t.link {\n\t\t\tcolor: #2867CE;\n\t\t\tmargin: 0 5rpx;\n\t\t}\n\t}\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["mapMutations","uni","http"],"mappings":"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"}