{"version":3,"names":["_sfc_main","data","computed","_objectSpread2","common_vendor$1","mapState","userInfo","state","user","info","onLoad","getUserInfo","onShow","methods","mapMutations","checkTokenExpiration","token","index","getStorageSync","_this","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","_a","res","wrap","_callee$","_context","prev","next","http","get","sent","code","SET_INFO","t0","response","status","CLEAR_ALL","redirectTo","url","stop","handleNavigate","checkToken","showModal","title","content","success","confirm","navigateTo","Object","keys","length","targetPath","replace","currentPath","getCurrentPages","pop","route","common_vendor","toEditProfile","logout","_this2","removeStorageSync","wx","createPage","MiniProgramPage"],"sources":["my.vue","cGFnZXMvbXkvbXkudnVl"],"sourcesContent":["<template>\n  <view class=\"my-container\">\n    <!-- 用户信息卡片 -->\n    <view class=\"user-card\" @click=\"toEditProfile\">\n      <image class=\"avatar\" :src=\"userInfo.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\" />\n      <view class=\"user-info\">\n        <text class=\"username\">{{ userInfo.nickname || '未设置昵称' }}</text>\n        <text class=\"edit-tip\">点击修改资料</text>\n      </view>\n      <uni-icons type=\"arrowright\" size=\"18\" color=\"#999\" />\n    </view>\n\n    <!-- 功能列表 -->\n    <view class=\"menu-list\">\n      <view class=\"menu-item\" @click=\"handleNavigate('/pages/my/my_likes')\">\n        <view class=\"item-content\">\n          <uni-icons type=\"heart-filled\" size=\"20\" color=\"#ff5a5f\" />\n          <text>我的点赞</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#999\" />\n      </view>\n\n      <view class=\"menu-item\" @click=\"handleNavigate('/pages/my/my_comments')\">\n        <view class=\"item-content\">\n          <uni-icons type=\"chatboxes-filled\" size=\"20\" color=\"#007aff\" />\n          <text>我的评论</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#999\" />\n      </view>\n\n      <view class=\"menu-item\" @click=\"handleNavigate('/pages/my/my_trips')\">\n        <view class=\"item-content\">\n          <uni-icons type=\"calendar-filled\" size=\"20\" color=\"#4cd964\" />\n          <text>我的行程</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#999\" />\n      </view>\n\n      <view class=\"menu-item\" @click=\"handleNavigate('/pages/my/settings')\">\n        <view class=\"item-content\">\n          <uni-icons type=\"gear-filled\" size=\"20\" color=\"#808080\" />\n          <text>设置</text>\n        </view>\n        <uni-icons type=\"arrowright\" size=\"16\" color=\"#999\" />\n      </view>\n    </view>\n\n    <!-- 退出登录按钮 -->\n    <view class=\"logout-btn\">\n      <button @click=\"logout\">退出登录</button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { mapState, mapMutations } from 'vuex';\nexport default {\n  data() {\n    return {\n      // 用户信息将从vuex获取\n    };\n  },\n  computed: {\r\n    ...mapState({\r\n      userInfo: (state) => state.user.info || {} // 路径改为 state.user.info\r\n    })\r\n  },\n  onLoad() {\r\n    this.getUserInfo();\r\n  },\r\n  onShow() {\r\n    this.getUserInfo(); // 双重保障防止页面缓存问题\r\n  },\n  methods: {\n    ...mapMutations(\"user\", [\"SET_INFO\", \"CLEAR_ALL\"]),\n\tcheckTokenExpiration() {\r\n\t  // 实现 token 过期检查逻辑\r\n\t  const token = uni.getStorageSync(\"token\");\r\n\t  return !!token; // 示例逻辑，需根据实际需求实现\r\n\t},\n    // 获取用户信息\n    async getUserInfo() {\n      try {\n        const res = await http.get(\"/user/info\");\n        if (res.data.code === 200) {\n          this.SET_INFO(res.data.data);\n        }\n      } catch (err) {\n        if (err.response?.status === 401) {\n          this.CLEAR_ALL();\n          uni.redirectTo({ url: \"/pages/login/login\" }); // 使用 uni.redirectTo\n        }\n      }\n    },\n\n    // 处理导航跳转\n    handleNavigate(url) {\r\n      const checkToken = this.checkTokenExpiration();\r\n      if (!checkToken) {\r\n              uni.showModal({ // 使用 uni.showModal\r\n                title: \"提示\",\r\n                content: \"请先登录\",\r\n                success: (res) => {\r\n                  if (res.confirm) {\r\n                    uni.navigateTo({ url: \"/pages/login/login\" });\r\n                  }\r\n                }\r\n              });\r\n              return;\r\n            }\r\n      // 仅在用户信息为空时重新获取\r\n      if (!this.userInfo || Object.keys(this.userInfo).length === 0) {\r\n        this.getUserInfo();\r\n      }\r\n      // 统一路径处理\r\n      const targetPath = url.replace(\"/pages/\", \"\").replace(/\\.html$/, \"\");\r\n      const currentPath = getCurrentPages().pop().route;\r\n      if (currentPath !== targetPath) {\r\n        common_vendor.index.navigateTo({ url });\r\n      }\r\n    },\n\n    // 跳转编辑资料\n    toEditProfile() {\n      this.handleNavigate('/pages/my/edit_profile');\n    },\n\n    // 退出登录\n    logout() {\n      uni.showModal({\n        title: '提示',\n        content: '确定要退出登录吗？',\n        success: (res) => {\n          if (res.confirm) {\n            this.CLEAR_ALL();\n            uni.removeStorageSync('token');\n            uni.redirectTo({\n              url: '/pages/login/login'\n            });\n          }\n        },\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.my-container {\n  padding: 20rpx;\n  min-height: 100vh;\n  background-color: #f5f5f5;\n\n  .user-card {\n    display: flex;\n    align-items: center;\n    padding: 30rpx;\n    background-color: #fff;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    \n    .avatar {\n      width: 120rpx;\n      height: 120rpx;\n      border-radius: 50%;\n      margin-right: 20rpx;\n    }\n\n    .user-info {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n\n      .username {\n        font-size: 36rpx;\n        font-weight: bold;\n        margin-bottom: 10rpx;\n      }\n\n      .edit-tip {\n        font-size: 24rpx;\n        color: #999;\n      }\n    }\n  }\n\n  .menu-list {\n    background-color: #fff;\n    border-radius: 16rpx;\n    overflow: hidden;\n\n    .menu-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 30rpx;\n      border-bottom: 1rpx solid #f0f0f0;\n      \n      &:last-child {\n        border-bottom: none;\n      }\n\n      .item-content {\n        display: flex;\n        align-items: center;\n        \n        text {\n          margin-left: 20rpx;\n          font-size: 32rpx;\n        }\n      }\n    }\n  }\n\n  .logout-btn {\n    margin-top: 40rpx;\n    \n    button {\n      background-color: #fff;\n      color: #2867CE;\n      border: none;\n      height: 90rpx;\n      line-height: 90rpx;\n      font-size: 32rpx;\n      border-radius: 10rpx;\n    }\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/my/my.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}