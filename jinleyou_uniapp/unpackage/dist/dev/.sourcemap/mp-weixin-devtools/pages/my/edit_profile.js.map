{"version":3,"names":["_sfc_main","data","form","avatar","nickname","gender","bio","originalForm","errors","genderOptions","label","value","uploading","uploadProgress","saving","loadingText","contentdown","contentrefresh","contentnomore","computed","_objectSpread2","common_vendor","mapState","formChanged","JSON","stringify","hasErrors","onLoad","initFormData","methods","mapMutations","userInfo","parse","changeAvatar","_this","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","_yield$common_vendor$","_yield$common_vendor$2","res","interval","wrap","_callee$","_context","prev","next","index","chooseImage","count","sizeType","sourceType","sent","_slicedToArray2","tempFilePaths","length","setInterval","clearInterval","setTimeout","t0","__f__","stop","uploadFile","filePath","Promise","resolve","reject","url","name","header","getStorageSync","success","code","Error","message","fail","onGenderChange","e","detail","validateNickname","saveProfile","_this2","_callee2","_yield$api_http$http$","_callee2$","_context2","abrupt","api_http","http","post","showToast","title","icon","SET_INFO","navigateBack","finish","goBack","showModal","content","confirm","wx","createPage","MiniProgramPage"],"sources":["edit_profile.vue","cGFnZXMvbXkvZWRpdF9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"edit-container\">\n    <!-- \n    <uni-nav-bar \n      title=\"编辑资料\" \n      left-icon=\"back\" \n      @clickLeft=\"goBack\"\n      :border=\"false\"\n      fixed\n    />\n    -->\n    <!-- 表单容器 -->\n    <scroll-view scroll-y class=\"form-container\">\n      <!-- 头像上传 -->\n      <view class=\"form-item\">\n        <text class=\"label\">头像</text>\n        <view class=\"avatar-upload\" @click=\"changeAvatar\">\n          <image class=\"avatar\" :src=\"form.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\" />\n          <uni-icons type=\"camera-filled\" size=\"24\" color=\"#fff\" class=\"camera-icon\" />\n          <view v-if=\"uploading\" class=\"upload-progress\">\n            <text>{{ uploadProgress }}%</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 昵称 -->\n      <view class=\"form-item\">\n        <text class=\"label\">昵称</text>\n        <input \n          v-model=\"form.nickname\" \n          placeholder=\"请输入2-12位昵称\" \n          maxlength=\"12\"\n          @blur=\"validateNickname\"\n        />\n        <text v-if=\"errors.nickname\" class=\"error-text\">{{ errors.nickname }}</text>\n      </view>\n      \n      <!-- 性别 -->\n      <view class=\"form-item\">\n        <text class=\"label\">性别</text>\n        <picker \n          mode=\"selector\" \n          :range=\"genderOptions\" \n          range-key=\"label\"\n          @change=\"onGenderChange\"\n        >\n          <view class=\"picker\">\n            {{ genderOptions[form.gender].label || '请选择性别' }}\n          </view>\n        </picker>\n      </view>\n      \n      <!-- 个人简介 -->\n      <view class=\"form-item\">\n        <text class=\"label\">个人简介</text>\n        <textarea \n          v-model=\"form.bio\" \n          placeholder=\"介绍一下自己吧~\"\n          maxlength=\"100\"\n          auto-height\n        />\n        <text class=\"word-count\">{{ form.bio.length }}/100</text>\n      </view>\n      \n      <!-- 保存按钮 -->\n      <button \n        class=\"save-btn\" \n        :class=\"{ disabled: !formChanged || hasErrors }\"\n        :disabled=\"!formChanged || hasErrors || saving\"\n        @click=\"saveProfile\"\n      >\n        <text v-if=\"!saving\">保存修改</text>\n        <uni-load-more v-else status=\"loading\" :icon-size=\"16\" :content-text=\"loadingText\" />\n      </button>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\nimport { mapMutations, mapState } from 'vuex';\r\nimport { http } from '@/api/http';\n\nexport default {\n  data() {\n    return {\n      form: {\n        avatar: '',\n        nickname: '',\n        gender: 0,\n        bio: ''\n      },\n      originalForm: {},\n      errors: {\n        nickname: ''\n      },\n      genderOptions: [\n        { label: '保密', value: 0 },\n        { label: '男', value: 1 },\n        { label: '女', value: 2 }\n      ],\n      uploading: false,\n      uploadProgress: 0,\n      saving: false,\n      loadingText: {\n        contentdown: '保存中',\n        contentrefresh: '保存中',\n        contentnomore: '保存中'\n      }\n    };\n  },\n  computed: {\n    ...mapState('user', ['userInfo']),\n    // 检查表单是否有变化\n    formChanged() {\n      return JSON.stringify(this.form) !== JSON.stringify(this.originalForm);\n    },\n    // 检查是否有错误\n    hasErrors() {\n      return this.errors.nickname !== '';\n    }\n  },\n  onLoad() {\n    // 初始化表单数据\n    this.initFormData();\n  },\n  methods: {\r\n\t...mapMutations('user', ['SET_INFO']),\n    // 初始化表单数据\n    initFormData() {\n      this.form = {\n        avatar: this.userInfo.avatar || '',\n        nickname: this.userInfo.nickname || '',\n        gender: this.userInfo.gender || 0,\n        bio: this.userInfo.bio || ''\n      };\n      this.originalForm = JSON.parse(JSON.stringify(this.form));\n    },\n    \n    // 更换头像\n    async changeAvatar() {\n      try {\n        const [res] = await uni.chooseImage({\n          count: 1,\n          sizeType: ['compressed'],\n          sourceType: ['album', 'camera']\n        });\n        \n        if (res.tempFilePaths.length) {\n          this.uploading = true;\n          this.uploadProgress = 0;\n          \n          // 模拟上传进度\n          const interval = setInterval(() => {\n            this.uploadProgress += 10;\n            if (this.uploadProgress >= 100) {\n              clearInterval(interval);\n              setTimeout(() => {\n                this.form.avatar = res.tempFilePaths[0];\n                this.uploading = false;\n              }, 300);\n            }\n          }, 200);\n          \n          // 实际项目中应该调用上传接口\n          // const uploadRes = await this.uploadFile(res.tempFilePaths[0]);\n          // this.form.avatar = uploadRes.url;\n        }\n      } catch (error) {\n        console.error('选择图片失败:', error);\n        this.uploading = false;\n      }\n    },\n    \n    // 上传文件 (实际项目中实现)\n    uploadFile(filePath) {\n      return new Promise((resolve, reject) => {\n        uni.uploadFile({\n          url: '/api/upload/avatar',\n          filePath,\n          name: 'file',\n          header: {\n            'Authorization': uni.getStorageSync('token')\n          },\n          success: (res) => {\n            const data = JSON.parse(res.data);\n            if (data.code === 200) {\n              resolve(data.data);\n            } else {\n              reject(new Error(data.message));\n            }\n          },\n          fail: reject\n        });\n      });\n    },\n    \n    // 性别选择\n    onGenderChange(e) {\n      this.form.gender = e.detail.value;\n    },\n    \n    // 验证昵称\n    validateNickname() {\n      if (!this.form.nickname) {\n        this.errors.nickname = '昵称不能为空';\n      } else if (this.form.nickname.length < 2) {\n        this.errors.nickname = '昵称太短';\n      } else {\n        this.errors.nickname = '';\n      }\n    },\n    \n    // 保存资料\n    async saveProfile() {\r\n      if (this.saving || !this.formChanged || this.hasErrors) return;\r\n      \r\n      this.saving = true;\r\n      try {\r\n        const { code, message } = await http.post('/user/update', this.form);\r\n        \r\n        if (code === 200) {\r\n          uni.showToast({ title: '修改成功', icon: 'success' });\r\n          this.SET_INFO(this.form);\r\n          setTimeout(() => uni.navigateBack(), 1500);\r\n        } else {\r\n          uni.showToast({ title: message, icon: 'none' });\r\n        }\r\n      } catch (error) {\r\n        console.error('保存失败:', error);\r\n        uni.showToast({ title: '保存失败，请重试', icon: 'none' });\r\n      } finally {\r\n        this.saving = false;\r\n      }\r\n    },\n    \n    goBack() {\n      if (this.formChanged) {\n        uni.showModal({\n          title: '提示',\n          content: '您有未保存的修改，确定要离开吗？',\n          success: (res) => {\n            if (res.confirm) {\n              uni.navigateBack();\n            }\n          }\n        });\n      } else {\n        uni.navigateBack();\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.edit-container {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background-color: #f5f5f5;\r\n  overflow: hidden;\n  \n  .form-container {\n    flex: 1;\n    padding: 30rpx;\r\n\twidth: 100vw;\r\n\tbox-sizing: border-box;\n    \n    .form-item {\r\n\t  overflow: visible;\r\n\t  width: 100%;\n      margin-bottom: 40rpx;\n      background-color: #fff;\n      padding: 30rpx;\n      border-radius: 12rpx;\n      box-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.05);\n      \n      .label {\n        display: block;\n        font-size: 28rpx;\n        color: #666;\n        margin-bottom: 20rpx;\n      }\n      \n      input, textarea, .picker {\n        width: 100%;\n        font-size: 28rpx;\n        padding: 10rpx 0;\n        border-bottom: 1rpx solid #eee;\n      }\n      \n      textarea {\n        min-height: 120rpx;\n      }\n      \n      .error-text {\n        color: #ff5a5f;\n        font-size: 24rpx;\n        margin-top: 10rpx;\n        display: block;\n      }\n      \n      .word-count {\n        color: #999;\n        font-size: 24rpx;\n        text-align: right;\n        display: block;\n        margin-top: 10rpx;\n      }\n      \n      .avatar-upload {\n        position: relative;\n        width: 120rpx;\n        height: 120rpx;\n        border-radius: 50%;\n        overflow: hidden;\n        \n        .avatar {\n          width: 100%;\n          height: 100%;\n        }\n        \n        .camera-icon {\n          position: absolute;\n          right: 0;\n          bottom: 0;\n          background-color: rgba(0, 0, 0, 0.5);\n          padding: 8rpx;\n          border-radius: 50%;\n        }\n        \n        .upload-progress {\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background-color: rgba(0, 0, 0, 0.5);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          \n          text {\n            color: #fff;\n            font-size: 24rpx;\n          }\n        }\n      }\n    }\n    \n    .save-btn {\n      margin-top: 60rpx;\n      background-color: #4cd964;\n      color: #fff;\n      border: none;\n      height: 80rpx;\n      line-height: 80rpx;\n      font-size: 32rpx;\n      border-radius: 40rpx;\n      \n      &.disabled {\n        background-color: #ccc;\n        opacity: 0.7;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/my/edit_profile.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}