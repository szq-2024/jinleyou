{"version":3,"names":["pageSize","scenicList","common_vendor","ref","loading","hasMore","isRefreshing","page","fetchScenicList","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","pageNum","_yield$common_vendor$","_yield$common_vendor$2","err","res2","responseData","newData","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","value","abrupt","JSON","stringify","res","data","index","__f__","request","url","concat","api_http","ENV_CONFIG","method","sent","_slicedToArray2","statusCode","Error","message","Array","isArray","map","item","_objectSpread2","imageUrl","cover","filter","_toConsumableArray2","total","t0","showToast","title","icon","duration","finish","stop","apply","loadMore","onRefresh","onMounted","wx","createPage","_sfc_main"],"sources":["index.vue","cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"scenic-list\">\r\n\t    <!-- 景点列表 -->\r\n\t    <scroll-view \r\n\t\t\tscroll-y \r\n\t\t\tclass=\"scenic-container\"\r\n\t\t\t@scrolltolower=\"loadMore\"\r\n\t\t\t:refresher-enabled=\"true\"\r\n\t\t\t:refresher-triggered=\"isRefreshing\"\r\n\t\t\t@refresherrefresh=\"onRefresh\"\r\n\t    >\r\n\t    <view class=\"scenic-grid\">\r\n\t        <view \r\n\t\t\t\tv-for=\"(item, index) in scenicList\" \r\n\t\t\t\t:key=\"index\"\r\n\t\t\t\tclass=\"scenic-item\"\r\n\t\t\t\t@click=\"handleDetail(item)\"\r\n\t        >\r\n\t        <image class=\"cover\" :src=\"item.imageUrl\" mode=\"aspectFill\" />\r\n\t        <view class=\"info\">\r\n\t            <text class=\"name\">{{item.name}}</text>\r\n\t            <text class=\"desc\">{{item.description}}</text>\r\n\t        </view>\r\n\t    </view>\r\n\t</view>\r\n\t\r\n\t    <!-- 加载更多 -->\r\n\t    <view v-if=\"hasMore\" class=\"loading-more\">\r\n\t        <text>加载中...</text>\r\n\t    </view>\r\n\t    <view v-else class=\"no-more\">\r\n\t        <text>没有更多了</text>\r\n\t    </view>\r\n\t    </scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { http, ENV_CONFIG } from '@/api/http';\n// 状态定义\nconst scenicList = ref([]);\nconst loading = ref(false);\nconst hasMore = ref(true);         // 新增分页控制\nconst isRefreshing = ref(false);   // 新增下拉刷新状态\nconst page = ref(1);               // 新增页码控制\nconst pageSize = 10;               // 每页数量\n\n// 获取景点列表（带分页参数）\n// 在script部分修改fetch逻辑\nconst fetchScenicList = async (pageNum = 1) => {\n  if (loading.value) return;\n  loading.value = true;\n  console.log('API响应数据:', JSON.stringify(res.data, null, 2));\r\n  console.log('当前页码:', pageNum, '总数据量:', scenicList.value.length);\n  try {\n    const [err, res] = await uni.request({\n      url: `${ENV_CONFIG[process.env.NODE_ENV]}/api/scenic-spots`,\n      method: 'GET',\n      data: {\n        page: pageNum,\n        pageSize: pageSize\n      }\n    });\n\n\t\t// 增强错误处理\r\n       if (err || !res.data || res.statusCode !== 200) {\r\n           throw new Error(err?.message || '无效的响应结构');\r\n       }\n    \n    // 根据实际返回数据结构调整\n    const responseData = res.data;\r\n\t\r\n\tif (!responseData.data || !Array.isArray(responseData.data)) {\r\n\t       console.error('无效的数据结构:', responseData);\r\n\t       throw new Error('服务器返回数据格式异常');\r\n\t   }\r\n    const newData = responseData.data.map(item => ({\r\n      ...item,\r\n      imageUrl: item.cover || '' // 将 cover 映射到 imageUrl\r\n    })); \n    \r\n\t// 强制类型校验（双重保障）\n    if (!Array.isArray(newData)) {\n      console.error('API返回数据格式异常:', newData);\n      throw new Error('数据格式错误');\n    }\r\n\t\n    // 分页处理逻辑\n    scenicList.value = pageNum === 1 \r\n      ? newData.filter(item => item.imageUrl) \r\n      : [...scenicList.value, ...newData.filter(item => item.imageUrl)];\r\n        \r\n    // 分页控制逻辑优化\r\n    hasMore.value = (pageNum * pageSize) < responseData.total;\r\n    if (hasMore.value) page.value = pageNum; \n    \n  } catch (error) {\n    uni.showToast({ \n      title: error.message || '加载失败',\n      icon: 'none',\n      duration: 2000\n    });\n  } finally {\n    loading.value = false;\n    isRefreshing.value = false;\n  }\n};\n\n// 加载更多\nconst loadMore = () => {\n  if (!hasMore.value || loading.value) return;\n  page.value += 1; // 先递增页码\n  fetchScenicList(page.value);\n};\n\n// 下拉刷新\nconst onRefresh = () => {\n  isRefreshing.value = true;\n  fetchScenicList(1); // 刷新时重置到第一页\n};\n\n// 初始化加载\nonMounted(() => fetchScenicList());\n</script>\r\n\n\n<style lang=\"scss\">\n.scenic-list {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  \n  .scenic-container {\n    height: 100vh;\n  }\n  \n  .scenic-grid {\n    padding: 32rpx;\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 32rpx;\n  }\n  \n  .scenic-item {\n    background-color: #fff;\n    border-radius: 12rpx;\n    overflow: hidden;\n    \n    .cover {\n      width: 100%;\n      height: 320rpx;\n      background-color: #f5f5f5;\n    }\n    \n    .info {\n      padding: 16rpx;\n      \n      .name {\n        font-size: 28rpx;\n        color: #333;\n        font-weight: 500;\n      }\n      \n      .desc {\n        font-size: 24rpx;\n        color: #666;\n        margin-top: 8rpx;\n        display: -webkit-box;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n        overflow: hidden;\n      }\n    }\n  }\n  \n  .loading-more, .no-more {\n    text-align: center;\n    padding: 24rpx 0;\n    font-size: 24rpx;\n    color: #999;\n  }\n}\n</style> \n","import MiniProgramPage from 'C:/Users/SZQ/Desktop/jinleyou_uniapp/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"mappings":";;;;;;;;;;AA8CA,IAAMA,QAAA,GAAW;;;;IALX,IAAAC,UAAA,GAAaC,aAAA,CAAAC,GAAA,CAAI,EAAE;IACnB,IAAAC,OAAA,GAAUF,aAAA,CAAAC,GAAA,CAAI,KAAK;IACnB,IAAAE,OAAA,GAAUH,aAAA,CAAAC,GAAA,CAAI,IAAI;IAClB,IAAAG,YAAA,GAAeJ,aAAA,CAAAC,GAAA,CAAI,KAAK;IACxB,IAAAI,IAAA,GAAOL,aAAA,CAAAC,GAAA,CAAI,CAAC;IAKZ,IAAAK,eAAA;MAAA,IAAAC,IAAA,GAAAC,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAkB,SAAAC,QAAA;QAAA,IAAAC,OAAA;UAAAC,qBAAA;UAAAC,sBAAA;UAAAC,GAAA;UAAAC,IAAA;UAAAC,YAAA;UAAAC,OAAA;UAAAC,KAAA,GAAAC,SAAA;QAAA,OAAAX,oBAAA,GAAAY,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAOb,OAAA,GAAAO,KAAA,CAAAO,MAAA,QAAAP,KAAA,QAAAQ,SAAA,GAAAR,KAAA,MAAU;cAAA,KACnCjB,OAAA,CAAQ0B,KAAA;gBAAAL,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAA,OAAAF,QAAA,CAAAM,MAAA;YAAA;cACZ3B,OAAA,CAAQ0B,KAAA,GAAQ;8EACJ,YAAYE,IAAA,CAAKC,SAAA,CAAUC,GAAA,CAAIC,IAAA,EAAM,MAAM,CAAC,CAAC;cAC7CjC,aAAA,CAAAkC,KAAA,CAAAC,KAAA,gDAASvB,OAAA,EAAS,SAASb,UAAA,CAAW6B,KAAA,CAAMF,MAAM;cAAAH,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAEnCzB,aAAA,CAAAkC,KAAA,CAAIE,OAAA,CAAQ;gBACnCC,GAAA,KAAAC,MAAA,CAAQC,QAAA,CAAAC,UAAA,CAAW,aAAoB,CAAC;gBACxCC,MAAA,EAAQ;gBACRR,IAAA,EAAM;kBACJ5B,IAAA,EAAMO,OAAA;kBACNd,QAAA,EAAAA;gBACF;cAAA,CACD;YAAA;cAAAe,qBAAA,GAAAU,QAAA,CAAAmB,IAAA;cAAA5B,sBAAA,GAAA6B,eAAA,CAAA9B,qBAAA;cAPME,GAAA,GAAAD,sBAAA;cAAKE,IAAG,GAAAF,sBAAA;cAAA,MAURC,GAAA,IAAO,CAACC,IAAA,CAAIiB,IAAA,IAAQjB,IAAA,CAAI4B,UAAA,KAAe;gBAAArB,QAAA,CAAAE,IAAA;gBAAA;cAAA;cAAA,MACjC,IAAIoB,KAAA,EAAM9B,GAAA,oBAAAA,GAAA,CAAK+B,OAAA,KAAW,SAAS;YAAA;cAI1C7B,YAAA,GAAeD,IAAA,CAAIiB,IAAA;cAAA,MAExB,CAAChB,YAAA,CAAagB,IAAA,IAAQ,CAACc,KAAA,CAAMC,OAAA,CAAQ/B,YAAA,CAAagB,IAAI;gBAAAV,QAAA,CAAAE,IAAA;gBAAA;cAAA;cACnDzB,aAAA,CAAAkC,KAAA,CAAcC,KAAA,qDAAYlB,YAAY;cAAA,MAChC,IAAI4B,KAAA,CAAM,aAAa;YAAA;cAE3B3B,OAAA,GAAUD,YAAA,CAAagB,IAAA,CAAKgB,GAAA,CAAI,UAASC,IAAA;gBAAA,OAAAC,cAAA,CAAAA,cAAA,KAC1CD,IAAA;kBACHE,QAAA,EAAUF,IAAA,CAAKG,KAAA,IAAS;kBAAA;gBAAA;cAAA,CACxB;cAAA,IAGGN,KAAA,CAAMC,OAAA,CAAQ9B,OAAO;gBAAAK,QAAA,CAAAE,IAAA;gBAAA;cAAA;cACxBzB,aAAA,CAAAkC,KAAA,CAAAC,KAAA,yCAAc,gBAAgBjB,OAAO;cAAA,MAC/B,IAAI2B,KAAA,CAAM,QAAQ;YAAA;cAI1B9C,UAAA,CAAW6B,KAAA,GAAQhB,OAAA,KAAY,IAC3BM,OAAA,CAAQoC,MAAA,CAAO,UAAAJ,IAAA;gBAAA,OAAQA,IAAA,CAAKE,QAAQ;cAAA,QAAAd,MAAA,CAAAiB,mBAAA,CAChCxD,UAAA,CAAW6B,KAAA,GAAA2B,mBAAA,CAAUrC,OAAA,CAAQoC,MAAA,CAAO,UAAQJ,IAAA;gBAAA,OAAAA,IAAA,CAAKE,QAAQ;cAAA,EAAC;cAG1DjD,OAAA,CAAAyB,KAAA,GAAShB,OAAA,GAAUd,QAAA,GAAYmB,YAAA,CAAauC,KAAA;cACpD,IAAIrD,OAAA,CAAQyB,KAAA,EAAOvB,IAAA,CAAKuB,KAAA,GAAQhB,OAAA;cAAAW,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAkC,EAAA,GAAAlC,QAAA;cAGhCvB,aAAA,CAAAkC,KAAA,CAAIwB,SAAA,CAAU;gBACZC,KAAA,EAAOpC,QAAA,CAAAkC,EAAA,CAAMX,OAAA,IAAW;gBACxBc,IAAA,EAAM;gBACNC,QAAA,EAAU;cAAA,CACX;YAAA;cAAAtC,QAAA,CAAAC,IAAA;cAEDtB,OAAA,CAAQ0B,KAAA,GAAQ;cAChBxB,YAAA,CAAawB,KAAA,GAAQ;cAAA,OAAAL,QAAA,CAAAuC,MAAA;YAAA;YAAA;cAAA,OAAAvC,QAAA,CAAAwC,IAAA;UAAA;QAAA,GAAApD,OAAA;MAAA,CACvB;MAAA,gBAxDIL,gBAAA;QAAA,OAAAC,IAAA,CAAAyD,KAAA,OAAA5C,SAAA;MAAA;IAAA,GAwDJ;IAIF,IAAM6C,QAAA,GAAW,SAAXA,SAAA,EAAiB;MACjB,KAAC9D,OAAA,CAAQyB,KAAA,IAAS1B,OAAA,CAAQ0B,KAAA,EAAO;MACrCvB,IAAA,CAAKuB,KAAA,IAAS;MACdtB,eAAA,CAAgBD,IAAA,CAAKuB,KAAK;IAAA;IAI5B,IAAMsC,SAAA,GAAY,SAAZA,UAAA,EAAkB;MACtB9D,YAAA,CAAawB,KAAA,GAAQ;MACrBtB,eAAA,CAAgB,CAAC;IAAA;IAITN,aAAA,CAAAmE,SAAA;MAAA,OAAM7D,eAAA,EAAiB;IAAA;;;;;;;;;;;;;;;;;;;;;;;;AC1HjC8D,EAAA,CAAGC,UAAA,CAAWC,SAAe","ignoreList":[]}